import streamlit as st
from openai import OpenAI
import google.generativeai as genai
from anthropic import Anthropic
from datetime import datetime
import pandas as pd
import json
import pathlib
from typing import Dict, List, Optional
from dataclasses import dataclass

from PIL import Image
import plotly.express as px 
import plotly.graph_objects as go
from typing import Dict, List, Optional, Union

from google.generativeai.types import HarmCategory, HarmBlockThreshold
from google.api_core.exceptions import ResourceExhausted

import folium
from streamlit_folium import folium_static
import random
import re 


# Page config must be the first Streamlit command
st.set_page_config(
    page_title="ê´‘ê³ ì¹´í”¼ ë¬¸êµ¬ ìƒì„± AI - Copybara", 
    page_icon="ğŸ¾", 
    layout="wide"
)

# ì•± ì œëª©
st.title("ğŸ¾ Copybara - ê´‘ê³ ì¹´í”¼ ë¬¸êµ¬ ìƒì„± AI")


image = Image.open("copybara_logo2.png")

new_width = 640  # ì›í•˜ëŠ” ë„ˆë¹„ë¡œ ì¡°ì •
width_percent = (new_width / float(image.size[0]))
new_height = int((float(image.size[1]) * float(width_percent)))
resized_image = image.resize((new_width, new_height), Image.LANCZOS)
st.image(resized_image)

# Initialize API keys from Streamlit secrets
#openai.api_key = st.secrets["chatgpt"]
genai.configure(api_key=st.secrets["gemini"])
anthropic = Anthropic(api_key=st.secrets["claude"])
client = OpenAI(api_key=st.secrets["chatgpt"])  # API í‚¤ ì…ë ¥



#ì±—-ì œ-í´ ìˆœì„œ ì˜¤ì™€ì—´
#'gemini-1.5-pro-exp-0827'
#'gemini-1.5-pro-002'
model_zoo = ['gpt-4o',
             'gemini-1.5-flash-002',
             'claude-3-5-haiku-20241022']

# Gemini model configuration
gemini_model = genai.GenerativeModel(model_zoo[1])

# Custom CSS ë¶€ë¶„ì„ ìˆ˜ì •
st.markdown("""
<style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

    [data-testid="stAppViewContainer"] {
        font-family: 'Pretendard', sans-serif;
    }

    /* ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ì„ ìœ„í•œ CSS ë³€ìˆ˜ í™œìš© */
    :root {
        --text-color: #1e293b;
        --bg-color: #ffffff;
        --card-bg: #ffffff;
        --border-color: #e2e8f0;
        --hover-border: #3b82f6;
        --prompt-bg: #f1f5f9;
    }

    /* ë‹¤í¬ëª¨ë“œì¼ ë•Œì˜ ìƒ‰ìƒ */
    [data-theme="dark"] {
        --text-color: #e2e8f0;
        --bg-color: #1e1e1e;
        --card-bg: #2d2d2d;
        --border-color: #4a4a4a;
        --hover-border: #60a5fa;
        --prompt-bg: #2d2d2d;
    }

    .prompt-editor {
        border: 2px solid var(--border-color);
        border-radius: 10px;
        padding: 1rem;
        background-color: var(--card-bg);
        color: var(--text-color);
    }

    .prompt-editor:hover {
        border-color: var(--hover-border);
        box-shadow: 0 0 0 1px var(--hover-border);
    }

    .prompt-tip {
        background-color: var(--prompt-bg);
        border-left: 4px solid var(--hover-border);
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 0 8px 8px 0;
        color: var(--text-color);
    }

    .result-card {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        transition: all 0.2s ease;
        color: var(--text-color);
        border: 1px solid var(--border-color);
    }
    
    .result-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .model-tag {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: white;
    }

    .score-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-weight: 600;
        background-color: var(--prompt-bg);
        color: var(--text-color);
        cursor: pointer;
    }
    
    .score-badge:hover {
        background-color: var(--border-color);
    }

    .history-item {
        border-left: 4px solid var(--hover-border);
        padding: 1rem;
        margin: 1rem 0;
        background-color: var(--card-bg);
        border-radius: 0 8px 8px 0;
        color: var(--text-color);
    }

    .prompt-feedback {
        background-color: var(--prompt-bg);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1rem;
        color: var(--text-color);
    }

    .improvement-tip {
        color: var(--hover-border);
        font-weight: 500;
    }

    /* Expander ìŠ¤íƒ€ì¼ë§ */
    .streamlit-expanderHeader {
        background-color: var(--prompt-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 0.5rem 1rem;
        font-weight: 600;
        color: var(--text-color);
    }
    
    .streamlit-expanderContent {
        border: 1px solid var(--border-color);
        border-top: none;
        border-radius: 0 0 8px 8px;
        padding: 1rem;
        background-color: var(--card-bg);
        color: var(--text-color);
    }
    
    /* ë¬¸ì„œ ì—ë””í„° ìŠ¤íƒ€ì¼ë§ */
    .stTextArea textarea {
        font-family: 'Pretendard', sans-serif;
        font-size: 0.9rem;
        line-height: 1.5;
        color: var(--text-color);
        background-color: var(--card-bg);
    }
    
    /* í”„ë¡¬í”„íŠ¸ ì„¹ì…˜ êµ¬ë¶„ */
    .prompt-section {
        margin: 1rem 0;
        padding: 1rem;
        background-color: var(--card-bg);
        border-radius: 8px;
        border: 1px solid var(--border-color);
        color: var(--text-color);
    }

    /* Plotly ì°¨íŠ¸ ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ */
    .js-plotly-plot .plotly .modebar {
        background-color: var(--card-bg) !important;
    }

    .js-plotly-plot .plotly .modebar-btn path {
        fill: var(--text-color) !important;
    }
    .result-card {
        transition: all 0.3s ease;
    }
    
    .result-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .progress-text {
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 0.5rem;
    }
    
    .stExpander {
        border: none !important;
        box-shadow: none !important;
    }
</style>
""", unsafe_allow_html=True)



# ë„ì‹œ ì¢Œí‘œ ë°ì´í„°
CITY_COORDINATES = {
    "ê°•ë¦‰": {"lat": 37.7519, "lon": 128.8760},
    "ê²½ì£¼": {"lat": 35.8562, "lon": 129.2245},
    "ê´‘ì£¼": {"lat": 35.1595, "lon": 126.8526},
    "ëŒ€êµ¬": {"lat": 35.8714, "lon": 128.6014},
    "ëŒ€ì „": {"lat": 36.3504, "lon": 127.3845},
    "ë¶€ì‚° í•´ìš´ëŒ€": {"lat": 35.1628, "lon": 129.1639},
    "ì†ì´ˆ": {"lat": 38.2070, "lon": 128.5918},
    "ìˆ˜ì›": {"lat": 37.2636, "lon": 127.0286},
    "ì—¬ìˆ˜": {"lat": 34.7604, "lon": 127.6622},
    "ìš©ì¸": {"lat": 37.2410, "lon": 127.1775},
    "ì „ì£¼": {"lat": 35.8468, "lon": 127.1297}
}


# MBTI ê·¸ë£¹ ìƒìˆ˜ ì •ì˜
MBTI_GROUPS = {
    "ë¶„ì„ê°€í˜•": ["INTJ", "INTP", "ENTJ", "ENTP"],
    "ì™¸êµê´€í˜•": ["INFJ", "INFP", "ENFJ", "ENFP"],
    "ê´€ë¦¬ìí˜•": ["ISTJ", "ISFJ", "ESTJ", "ESFJ"],
    "íƒí—˜ê°€í˜•": ["ISTP", "ISFP", "ESTP", "ESFP"]
}

# Constants
MBTI_TYPES = [
    "INTJ", "INTP", "ENTJ", "ENTP",
    "INFJ", "INFP", "ENFJ", "ENFP",
    "ISTJ", "ISFJ", "ESTJ", "ESFJ",
    "ISTP", "ISFP", "ESTP", "ESFP"
]

MODEL_COLORS = {
    "gpt": "#10a37f",  # OpenAI ê·¸ë¦°
    "gemini": "#4285f4",  # Google ë¸”ë£¨
    "claude": "#8e44ad"  # Claude í¼í”Œ
}


# ê³„ì ˆ ìƒìˆ˜ ì¶”ê°€
SEASONS = {
    "ë´„": "spring",
    "ì—¬ë¦„": "summer",
    "ê°€ì„": "autumn",
    "ê²¨ìš¸": "winter"
}

PERSONAS = {
    "íŒŒë¸”ë¡œ ë„¤ë£¨ë‹¤": {
        "description": "ì¹ ë ˆ ì¶œì‹ ì˜ ë…¸ë²¨ë¬¸í•™ìƒ ìˆ˜ìƒ ì‹œì¸ìœ¼ë¡œ, ê°ê°ì ì´ê³  ê´€ëŠ¥ì ì¸ ì‹œì  í‘œí˜„ìœ¼ë¡œ ì‚¬ë‘ê³¼ ìì—°ì˜ ì•„ë¦„ë‹¤ì›€, ì •ì¹˜ì  ì—´ì •ì„ ë…¸ë˜í•œë‹¤. ì€ìœ ì™€ ìƒì§•ì„ í†µí•´ ê°•ë ¬í•œ ì´ë¯¸ì§€ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì´ íŠ¹ì§•ì´ë‹¤.",
        "samples": [
            "ë°”ë‹¤ì—¬, ë„ˆì˜ í‘¸ë¥¸ ì‹¬ì¥ì— ë‚´ ì˜í˜¼ì„ ë§¡ê¸°ë¦¬. ì´ê³³ì—ì„œ ì‚¬ë‘ì€ íŒŒë„ì²˜ëŸ¼ ëì—†ì´ ë°€ë ¤ì˜¨ë‹¤. ğŸŒŠâ¤ï¸",
            "ê·¸ëŒ€ì˜ ë¯¸ì†ŒëŠ” ì´ ë„ì‹œì˜ ê½ƒë“¤ë³´ë‹¤ ì•„ë¦„ë‹µì†Œ. ì—¬í–‰ì€ ìš°ë¦¬ì˜ ì‚¬ë‘ì‹œê°€ ë˜ë¦¬ë¼. ğŸŒºğŸ’–",
            "í–‡ì‚´ì€ ê·¸ëŒ€ì˜ í”¼ë¶€ì— ì…ë§ì¶”ê³ , ë°”ëŒì€ ìš°ë¦¬ì˜ ì´ì•¼ê¸°ë¥¼ ì†ì‚­ì¸ë‹¤. ì´ê³³ì—ì„œ ì˜ì›ì„ ë§Œë‚˜ë¦¬. â˜€ï¸ğŸƒ"
        ],
        "category": "literature",
        "nationality": "ğŸ‡¨ğŸ‡±"  # ì¹ ë ˆ (íŒŒë¸”ë¡œ ë„¤ë£¨ë‹¤)
    },
    "í”„ë¦¬ë“œë¦¬íˆ ë‹ˆì²´": {
        "description": "ë…ì¼ì˜ ì² í•™ìë¡œ, ì² í•™ì ì´ê³  ê°•ë ¬í•œ ë¬¸ì²´ë¡œ ì¸ê°„ì˜ ë³¸ì„±ê³¼ ì´ˆì›”ì  ì£¼ì œë¥¼ íƒêµ¬í•œë‹¤. ëŒ€ë‹´í•˜ê³  ëª…ì–¸ì ì¸ ì–¸ì–´ë¥¼ êµ¬ì‚¬í•˜ë©°, ê¸°ì¡´ ê°€ì¹˜ê´€ì— ë„ì „í•˜ëŠ” ì‚¬ìƒì„ í¼ì¹œë‹¤.",
        "samples": [
            "ë†’ì€ ì‚°ì •ì— ì˜¬ë¼ ìì‹ ì„ ë„˜ì–´ì„œë¼. ì´ê³³ì—ì„œ ë‹¹ì‹ ì€ ì§„ì •í•œ ì´ˆì¸(Ãœbermensch)ì´ ë  ìˆ˜ ìˆë‹¤. ğŸ”ï¸ğŸ’ª",
            "ì˜ì›íšŒê·€ì˜ ìˆœê°„ì„ ì´ê³³ì—ì„œ ê²½í—˜í•˜ë¼. ë‹¹ì‹ ì˜ ì˜ì§€ê°€ ì„¸ìƒì„ ë³€í™”ì‹œí‚¬ ê²ƒì´ë‹¤. ğŸ”„ğŸŒ",
            "ì‹ ì€ ì£½ì—ˆë‹¤. ì´ì œ ë‹¹ì‹ ì´ ìì‹ ì˜ ìš´ëª…ì„ ì°½ì¡°í•  ë•Œë‹¤. ì´ ì—¬í–‰ì´ ë‹¹ì‹ ì˜ ìƒˆë¡œìš´ ì‹œì‘ì´ ë˜ë¦¬ë¼. âš¡ğŸ”¨"
        ],
        "category": "literature",
        "nationality": "ğŸ‡©ğŸ‡ª"
    },
    "ì…°ìµìŠ¤í”¼ì–´": {
        "description": "ì˜êµ­ì˜ ê·¹ì‘ê°€ì´ì ì‹œì¸ìœ¼ë¡œ, ì—°ê·¹ì ì´ê³  ì€ìœ ì ì¸ ë¬¸ì²´ë¡œ ê°ì •ì„ ê·¹ëŒ€í™”í•˜ë©°, ë³µì¡í•œ ì‹¬ë¦¬ì™€ ì¸ê°„ ë³¸ì„±ì„ ì„œì‚¬ì ìœ¼ë¡œ í‘œí˜„í•œë‹¤. í’ë¶€í•œ ì–´íœ˜ì™€ ë…ì°½ì ì¸ í‘œí˜„ìœ¼ë¡œ ìœ ëª…í•˜ë‹¤.",
        "samples": [
            "ì´ ë„ì‹œëŠ” ë¬´ëŒ€ìš”, ìš°ë¦¬ëŠ” ëª¨ë‘ ë°°ìš°ë¼. ë‹¹ì‹ ì˜ ì¸ìƒê·¹ì„ ì´ê³³ì—ì„œ í¼ì³ë³´ì‹œì˜¤. ì„¸ìƒ ëª¨ë“  ê²ƒì´ ì—°ê·¹ì´ë‹ˆ. ğŸ­ğŸŒ†",
            "ì‚¬ë‘ì´ì—¬, ë‚˜ì˜ ì‚¬ë‘ì´ì—¬! ì´ê³³ì—ì„œ ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£ì˜ ì—´ì •ì„ ëŠê»´ë³´ì‹œì˜¤. ë°œì½”ë‹ˆì˜ ë‹¬ë¹›ì´ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦¬ì˜¤. ğŸŒ™ğŸ’•",
            "To be, or not to be, ê·¸ê²ƒì´ ë¬¸ì œë¡œë‹¤. ì´ ì—¬í–‰ì—ì„œ ë‹¹ì‹ ì˜ ì¡´ì¬ ì˜ë¯¸ë¥¼ ì°¾ì•„ë³´ì‹œì˜¤. í–„ë¦¿ì˜ ê³ ë‡Œê°€ ë‹¹ì‹ ì˜ ê¹¨ë‹¬ìŒì´ ë˜ë¦¬ë¼. ğŸ’€ğŸ¤”"
        ],
        "category": "literature",
        "nationality": "ğŸ‡¬ğŸ‡§"
    },
    "ìœ¤ë™ì£¼": {
        "description": "í•œêµ­ì˜ ì‹œì¸ìœ¼ë¡œ, ì„œì •ì ì´ê³  ê°ì„±ì ì¸ ìŠ¤íƒ€ì¼ë¡œ ìì—°ê³¼ ì¸ê°„ ë‚´ë©´ì„ íƒêµ¬í•œë‹¤. ì§§ê³  ê°•ë ¬í•œ ì€ìœ ë¡œ ê¹Šì€ ê°ë™ì„ ì „ë‹¬í•˜ë©°, ìˆœìˆ˜í•œ ì˜í˜¼ê³¼ ì €í•­ ì •ì‹ ì„ ë…¸ë˜í•œë‹¤.",
        "samples": [
            "í•˜ëŠ˜ì„ ìš°ëŸ¬ëŸ¬ í•œ ì  ë¶€ë„ëŸ¼ ì—†ì´, ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ë³„ì„ ì°¾ì•„ë³´ì„¸ìš”. ì„œì‹œ(åºè©©)ì˜ ì—¬í–‰ì´ ì‹œì‘ë©ë‹ˆë‹¤. â­ğŸƒ",
            "ì‰½ê²Œ ì”Œì–´ì§„ ì‹œì²˜ëŸ¼, ì´ê³³ì—ì„œì˜ ìˆœê°„ë“¤ì´ ë‹¹ì‹ ì˜ ë§ˆìŒì— ìƒˆê²¨ì§€ê¸°ë¥¼. ì†Œë…„ì˜ ìˆœìˆ˜í•¨ìœ¼ë¡œ ì—¬í–‰ì„ ì¦ê¸°ì„¸ìš”. ğŸ“ğŸŒ±",
            "ìí™”ìƒì„ ê·¸ë¦¬ë“¯, ì´ ì—¬í–‰ì—ì„œ ì§„ì •í•œ ìì‹ ì„ ë§Œë‚˜ë³´ì„¸ìš”. ê´´ë¡œì› ë˜ ì‚¬ë‘ê¹Œì§€ë„ ë³„ì´ ë˜ì–´ ë¹›ë‚  ê±°ì˜ˆìš”. ğŸ¨ğŸŒ "
        ],
        "category": "literature",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "ì–´ë‹ˆìŠ¤íŠ¸ í—¤ë°ì›¨ì´": {
        "description": "ë¯¸êµ­ì˜ ì†Œì„¤ê°€ë¡œ, ê°„ê²°í•˜ê³  í˜ ìˆëŠ” ë¬¸ì²´ë¡œ ì¸ê°„ì˜ ê³ ë…ê³¼ íˆ¬ìŸì„ ë¬˜ì‚¬í•œë‹¤. ê°•ë ¬í•œ ì´ë¯¸ì§€ì™€ ì§ì„¤ì ì¸ í‘œí˜„ìœ¼ë¡œ ì¸ìƒì˜ ë³¸ì§ˆì„ íƒêµ¬í•˜ë©°, ëª¨í—˜ê³¼ ìš©ê¸°ë¥¼ ì£¼ì œë¡œ ë‹¤ë£¬ë‹¤.",
        "samples": [
            "ë°”ë‹¤ì™€ ë…¸ì¸ì²˜ëŸ¼, ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ìœ„ëŒ€í•œ ë„ì „ì´ ì‹œì‘ëœë‹¤. íŒ¨ë°°í•˜ì§€ ì•Šì€ ì±„ íŒŒê´´ë  ë¿ì´ë‹¤. ğŸŒŠğŸ£",
            "í‚¬ë¦¬ë§Œìë¡œì˜ ëˆˆì²˜ëŸ¼ ìˆœìˆ˜í•˜ê³  ì˜ì›í•œ ê²ƒì„ ì´ê³³ì—ì„œ ì°¾ì•„ë³´ë¼. ë‹¹ì‹ ì˜ ì‚¶ì´ ê°€ì¥ ì§§ê³  ê°•ë ¬í•œ ë¬¸ì¥ì´ ë˜ë¦¬ë¼. â›°ï¸ğŸ“˜",
            "í”¼ì—ìŠ¤íƒ€ì˜ ì—´ê¸° ì†ì—ì„œ ìƒì–´ë²„ë¦° ì„¸ëŒ€ë¥¼ ë§Œë‚˜ë³´ë¼. ì´ê³³ì—ì„œ ë‹¹ì‹ ì€ í•´ëŠ” ë˜ ë‹¤ì‹œ ëœ¬ë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹«ê²Œ ë  ê²ƒì´ë‹¤. ğŸŒ…ğŸ·"
        ],
        "category": "literature",
        "nationality": "ğŸ‡ºğŸ‡¸"
    },
    "ì•Œë² ë¥´ ì¹´ë®ˆ": {
        "description": "í”„ë‘ìŠ¤ì˜ ì†Œì„¤ê°€ì´ì ì² í•™ìë¡œ, ë¶€ì¡°ë¦¬ì™€ ì¸ê°„ì˜ ë³¸ì„±ì„ íƒêµ¬í•˜ë©°, ê°„ê²°í•˜ë©´ì„œë„ ì² í•™ì ì¸ ë¬¸ì²´ë¡œ ì‹¬ì˜¤í•œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•œë‹¤. ì‹¤ì¡´ì£¼ì˜ì  ì‚¬ê³ ì™€ ì¸ê°„ì˜ ììœ ë¥¼ ì¤‘ìš”í•˜ê²Œ ë‹¤ë£¬ë‹¤.",
        "samples": [
            "ì´ë°©ì¸ì´ ë˜ì–´ ì´ ë„ì‹œì˜ ë¶€ì¡°ë¦¬ë¥¼ ë§ˆì£¼í•˜ë¼. ì§„ì •í•œ ììœ ëŠ” ì—¬ê¸°ì„œ ì‹œì‘ëœë‹¤. ğŸ™ï¸ğŸš¶",
            "ì‹œì§€í”„ìŠ¤ì²˜ëŸ¼ ëŠì„ì—†ì´ ë„ì „í•˜ë¼. ì´ ì—¬í–‰ì—ì„œ ë‹¹ì‹ ì€ ë¶ˆê°€ëŠ¥ì— ë§ì„œëŠ” ì˜ì›…ì´ ëœë‹¤. ğŸ”ï¸ğŸ”„",
            "í˜ìŠ¤íŠ¸ì™€ ê°™ì€ ê³ ë‚œ ì†ì—ì„œë„ ì¸ê°„ì˜ ì¡´ì—„ì„ ë°œê²¬í•˜ë¼. ì´ê³³ì—ì„œ ë‹¹ì‹ ì€ ì—°ëŒ€ì˜ ê°€ì¹˜ë¥¼ ê¹¨ë‹«ê²Œ ë  ê²ƒì´ë‹¤. ğŸ¤ğŸŒŸ"
        ],
        "category": "literature",
        "nationality": "ğŸ‡«ğŸ‡·"
    },
    "í—¤ë¥´ë§Œ í—¤ì„¸": {
        "description": "ë…ì¼ê³„ ìŠ¤ìœ„ìŠ¤ ì‘ê°€ë¡œ, ì² í•™ì ì´ê³  ë‚´ë©´ íƒêµ¬ì ì¸ ìŠ¤íƒ€ì¼ë¡œ ì¸ê°„ì˜ ì„±ì¥ê³¼ ìê¸° ì‹¤í˜„ì„ ì£¼ì œë¡œ í•œ ì‹¬ì˜¤í•œ ë¬¸ì²´ë¥¼ ê°€ì§„ ë…¸ë²¨ë¬¸í•™ìƒ ìˆ˜ìƒ ì†Œì„¤ê°€. ë™ì–‘ ì² í•™ì˜ ì˜í–¥ì„ ë°›ì•„ ì˜ì„±ê³¼ ìì•„ íƒêµ¬ë¥¼ ì‘í’ˆì— ë…¹ì—¬ëƒˆë‹¤.",
        "samples": [
            "ë‹¹ì‹ ì˜ ë‚´ë©´ ì—¬í–‰ì´ ì‹œì‘ë˜ëŠ” ê³³. ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ ìœ ë¦¬ì•Œ ìœ í¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”. ğŸ”®ğŸŒ¿",
            "ì‹¯ë‹¤ë¥´íƒ€ì²˜ëŸ¼ ê¹¨ë‹¬ìŒì„ í–¥í•œ ì—¬ì •ì„ ë– ë‚˜ë³´ì„¸ìš”. ì´ ë„ì‹œì˜ ê°•ë¬¼ì´ ë‹¹ì‹ ì—ê²Œ ì§„ë¦¬ë¥¼ ì†ì‚­ì¼ ê²ƒì…ë‹ˆë‹¤. ğŸï¸ğŸ§˜",
            "í™©ì•¼ì˜ ì´ë¦¬ì²˜ëŸ¼ ììœ ë¡­ê²Œ, ë°ë¯¸ì•ˆì˜ ëˆˆìœ¼ë¡œ ì„¸ìƒì„ ë°”ë¼ë³´ì„¸ìš”. ë‹¹ì‹ ì˜ ë‚´ë©´ì—ì„œ ìƒˆë¡œìš´ ì„¸ê³„ê°€ ì—´ë¦½ë‹ˆë‹¤. ğŸºğŸŒ„"
        ],
        "category": "literature",
        "nationality": "ğŸ‡¨ğŸ‡­"
    },
    "ì˜¥íƒ€ë¹„ì˜¤ íŒŒìŠ¤": {
        "description": "ë©•ì‹œì½”ì˜ ì‹œì¸ì´ì ì™¸êµê´€ìœ¼ë¡œ, í’ë¶€í•œ ì€ìœ ì™€ ìƒì§•ìœ¼ë¡œ ì¸ê°„ê³¼ ìì—°ì˜ ê´€ê³„ë¥¼ íƒêµ¬í•˜ë©°, ê°ê°ì ì´ê³  ì² í•™ì ì¸ ë¬¸ì²´ë¥¼ ì§€ë‹Œ ë…¸ë²¨ë¬¸í•™ìƒ ìˆ˜ìƒì. ì„œêµ¬ì™€ ë™ì–‘ ë¬¸í™”ì˜ ìœµí•©ì„ ì‹œë„í–ˆë‹¤.",
        "samples": [
            "ì‹œê°„ì˜ ë¯¸ë¡œì—ì„œ ë‹¹ì‹ ì˜ í˜„ì¬ë¥¼ ë§Œë‚˜ì„¸ìš”. ì´ê³³ì€ ê³¼ê±°ì™€ ë¯¸ë˜ê°€ ì¶¤ì¶”ëŠ” ì˜ì›ì˜ ìˆœê°„ì…ë‹ˆë‹¤. â³ğŸŒ€",
            "íƒœì–‘ì˜ ëŒì²˜ëŸ¼ ë¹›ë‚˜ëŠ” ì´ ë„ì‹œì—ì„œ, ë‹¹ì‹ ì˜ ë‚´ë©´ê³¼ ì™¸ë©´ì´ í•˜ë‚˜ë¡œ ìœµí•©ë˜ëŠ” ê²½í—˜ì„ í•˜ì„¸ìš”. â˜€ï¸ğŸ—¿",
            "ê³ ë…ì˜ ë¯¸ë¡œì—ì„œ ë²—ì–´ë‚˜ íƒ€ì¸ê³¼ì˜ ì—°ê²°ì„ ì°¾ì•„ë³´ì„¸ìš”. ì´ê³³ì—ì„œ ë‹¹ì‹ ì€ ì„¸ìƒì˜ ì‹œê°€ ë©ë‹ˆë‹¤. ğŸŒğŸ“œ"
        ],
        "category": "literature",
        "nationality": "ğŸ‡²ğŸ‡½"  # ë©•ì‹œì½” (ì˜¥íƒ€ë¹„ì˜¤ íŒŒìŠ¤)
    },
    "ë§ˆì“°ì˜¤ ë°”ì‡¼": {
        "description": "ì¼ë³¸ì˜ ì—ë„ ì‹œëŒ€ ì‹œì¸ìœ¼ë¡œ, í•˜ì´ì¿ ì˜ ëŒ€ê°€ì´ì ì—¬í–‰ ë¬¸í•™ì˜ ì„ êµ¬ì. ìì—°ê³¼ ì¸ê°„ì˜ ìˆœê°„ì  ê°í¥ì„ ê°„ê²°í•˜ê³  ê¹Šì´ ìˆê²Œ í‘œí˜„í•˜ë©°, ì„ ë¶ˆêµì˜ ì˜í–¥ì„ ë°›ì€ ì² í•™ì  ê¹Šì´ë¥¼ ì§€ë…”ë‹¤.",
        "samples": [
            "ì˜¤ë˜ëœ ì—°ëª», ê°œêµ¬ë¦¬ ë›°ì–´ë“¤ì–´ ë¬¼ì†Œë¦¬ ì²¨ë²™. ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ í•˜ì´ì¿ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”. ğŸ¸ğŸ’¦",
            "ê°€ì„ ë°”ëŒì— í©ë‚ ë¦¬ëŠ” ë‹¨í’ìì²˜ëŸ¼, ì´ ì—¬í–‰ì´ ë‹¹ì‹ ì˜ ë§ˆìŒì„ í”ë“¤ì–´ ê¹¨ìš°ê¸°ë¥¼. ğŸğŸŒ¬ï¸",
            "ë‹¬ ë°ì€ ë°¤, ëˆˆ ë®ì¸ ì‚°ê¸¸ì„ ê±¸ì–´ë³´ì„¸ìš”. ê³ ìš” ì†ì—ì„œ ì§„ì •í•œ ìì•„ë¥¼ ë§Œë‚  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”. ğŸŒ™â„ï¸"
        ],
        "category": "literature",  # ì •í™•í•œ ì¹´í…Œê³ ë¦¬ëª… ì‚¬ìš©
        "nationality": "ğŸ‡¯ğŸ‡µ"
    },
    "ì¼ë¡  ë¨¸ìŠ¤í¬": {
        "description": "ë‚¨ì•„í”„ë¦¬ì¹´ ê³µí™”êµ­ ì¶œì‹ ì˜ ê¸°ì—…ê°€ì´ì ì—”ì§€ë‹ˆì–´ë¡œ, í˜ì‹ ì ì¸ ê¸°ìˆ ê³¼ ëŒ€ë‹´í•œ ë¹„ì „ìœ¼ë¡œ ìš°ì£¼ íƒì‚¬, ì „ê¸°ì°¨, ì¸ê³µì§€ëŠ¥ ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ í˜ëª…ì„ ì¼ìœ¼í‚¤ê³  ìˆëŠ” ê¸°ì—…ì¸. ë„ì „ì ì´ê³  ë¯¸ë˜ì§€í–¥ì ì¸ ì‚¬ê³ ë°©ì‹ì´ íŠ¹ì§•ì´ë‹¤.",
        "samples": [
            "ì§€êµ¬ë¥¼ ë„˜ì–´ í™”ì„±ìœ¼ë¡œ! ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ìš°ì£¼ì  ê¿ˆì„ í‚¤ì›Œë³´ì„¸ìš”. ë¶ˆê°€ëŠ¥ì€ ì—†ìŠµë‹ˆë‹¤. ğŸš€ğŸ”´",
            "ì „ê¸°ë¡œ ë‹¬ë¦¬ëŠ” ë¯¸ë˜, ì´ ë„ì‹œì—ì„œ ê²½í—˜í•´ë³´ì„¸ìš”. ì§€ì† ê°€ëŠ¥í•œ í˜ì‹ ì´ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ğŸ”ŒğŸš—",
            "ì¸ê³µì§€ëŠ¥ê³¼ í•¨ê»˜í•˜ëŠ” ìƒˆë¡œìš´ ì„¸ìƒ, ì´ê³³ì—ì„œ ë¯¸ë˜ë¥¼ ì„ ë„í•˜ëŠ” ì•„ì´ë””ì–´ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ğŸ¤–ğŸ’¡"
        ],
        "category": "tech",
        "nationality": "ğŸ‡¿ğŸ‡¦"
    },
    "ë¹Œ ê²Œì´ì¸ ": {
        "description": "ë¯¸êµ­ì˜ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œìì´ì ê¸°ì—…ê°€ë¡œ, ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ì˜ ê³µë™ ì°½ë¦½ì. í˜ì‹ ì ì¸ ê¸°ìˆ ë¡œ ì»´í“¨í„° í˜ëª…ì„ ì´ëŒì—ˆìœ¼ë©°, í˜„ì¬ëŠ” ìì„ ì‚¬ì—…ê°€ë¡œì„œ ê¸€ë¡œë²Œ ê±´ê°•ê³¼ êµìœ¡ ë¬¸ì œ í•´ê²°ì— í˜ì“°ê³  ìˆë‹¤.",
        "samples": [
            "ëª¨ë“  ê°€ì •ì— ì»´í“¨í„°ë¥¼! ì´ê³³ì—ì„œ ê¸°ìˆ ì˜ ë¯¼ì£¼í™”ë¥¼ ê²½í—˜í•´ë³´ì„¸ìš”. ì§€ì‹ì€ í˜ì…ë‹ˆë‹¤. ğŸ’»ğŸŒ",
            "ê±´ê°•í•œ ì„¸ìƒì„ í–¥í•œ ì—¬ì •, ì´ ë„ì‹œì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì‘ì€ ë…¸ë ¥ì´ ì„¸ìƒì„ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”. ğŸ’‰ğŸŒ±",
            "êµìœ¡ì˜ í˜ì„ ë¯¿ìœ¼ì„¸ìš”. ì´ê³³ì—ì„œ ë°°ì›€ì˜ ê¸°íšŒë¥¼ ë§Œë‚˜ê³ , ë¯¸ë˜ë¥¼ ì¤€ë¹„í•˜ì„¸ìš”. ğŸ“šğŸ”¬"
        ],
        "category": "tech",
        "nationality": "ğŸ‡ºğŸ‡¸"
    },
    "ë„ë„ë“œ íŠ¸ëŸ¼í”„": {
        "description": "ë¯¸êµ­ì˜ ê¸°ì—…ì¸ì´ì ì •ì¹˜ì¸ìœ¼ë¡œ, ì œ45ëŒ€ ë¯¸êµ­ ëŒ€í†µë ¹ì„ ì—­ì„í–ˆë‹¤. ì§ì„¤ì ì´ê³  ë…¼ë€ì ì¸ ë°œì–¸ìœ¼ë¡œ ìœ ëª…í•˜ë©°, 'ë¯¸êµ­ ìš°ì„ ì£¼ì˜'ë¥¼ ì£¼ì°½í•˜ê³  ì´ë¯¼ ì •ì±… ê°•í™”, ë¬´ì—­ í˜‘ì • ì¬ê²€í†  ë“±ì„ ì¶”ì§„í–ˆë‹¤.",
        "samples": [
            "Make America Great Again! ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ê¿ˆì„ ì´ë£¨ì„¸ìš”. ìŠ¹ìëŠ” ì ˆëŒ€ í¬ê¸°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ğŸ‡ºğŸ‡¸ğŸ†",
            "The Art of the Dealì„ ì‹¤ì²œí•  ë•Œì…ë‹ˆë‹¤. ì´ ë„ì‹œì—ì„œ ìµœê³ ì˜ ê±°ë˜ë¥¼ ì„±ì‚¬ì‹œì¼œë³´ì„¸ìš”. í˜‘ìƒì˜ ë‹¬ì¸ì´ ë˜ì„¸ìš”. ğŸ¤ğŸ’¼",
            "ë†’ì€ ë²½ì„ ìŒ“ì•„ ì•ˆì „í•œ ì—¬í–‰ì„ ì¦ê¸°ì„¸ìš”. ì´ê³³ì€ ë‹¹ì‹ ì˜ íŠ¸ëŸ¼í”„ íƒ€ì›Œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ™ï¸ğŸ”’"
        ],
        "category": "politics",
        "nationality": "ğŸ‡ºğŸ‡¸"
    },
    "ë°±ì¢…ì›": {
        "description": "í•œêµ­ì˜ ìœ ëª… ìš”ë¦¬ì—°êµ¬ê°€ì´ì ì‚¬ì—…ê°€ë¡œ, ì¹œê·¼í•˜ê³  ì‹¤ìš©ì ì¸ ì–´ì¡°ë¡œ ìš”ë¦¬ì™€ ìŒì‹ì— ëŒ€í•œ ì—´ì •ì„ ì „ë‹¬í•œë‹¤. ëŒ€ì¤‘ì ì¸ ì†Œí†µ ëŠ¥ë ¥ê³¼ ë‹¤ì–‘í•œ ì™¸ì‹ ì‚¬ì—… ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ìŒì‹ ë¬¸í™”ì— í° ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆë‹¤.",
        "samples": [
            "ì—¬ê¸° ì˜¤ì…¨ìœ¼ë©´ ì´ ì§€ì—­ ë§›ì§‘ì€ ê¼­ ê°€ë³´ì…”ì•¼ì£ ! í˜„ì§€ì˜ ë§›ì„ ì œëŒ€ë¡œ ì¦ê²¨ë³´ì„¸ìš”. ë“ ë“ í•˜ê²Œ ë°°ë¶€ë¥´ê²Œ! ğŸ½ï¸ğŸ˜Š",
            "ì´ ë„ì‹œì˜ ì‹œì¥ì— ê°€ë³´ì„¸ìš”. ì‹ ì„ í•œ ì¬ë£Œë¡œ ê°€ë“í•œ ê³³ì´ì—ìš”. ìš”ë¦¬ì˜ ì¦ê±°ì›€ì„ ëŠê»´ë³´ì„¸ìš”! ğŸ¥˜ğŸ›’",
            "ê³¨ëª©ì‹ë‹¹ ê°™ì€ ìˆ¨ì€ ë§›ì§‘ì„ ì°¾ì•„ë³´ì„¸ìš”. ì†Œë°•í•˜ì§€ë§Œ ì •ì„± ê°€ë“í•œ í˜„ì§€ ìŒì‹ì˜ ë§›, ë†“ì¹˜ì§€ ë§ˆì„¸ìš”! ğŸœğŸ‘¨â€ğŸ³"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "ìœ ì¬ì„": {
        "description": "í•œêµ­ì˜ êµ­ë¯¼ MCë¡œ ë¶ˆë¦¬ëŠ” ë°©ì†¡ì¸ìœ¼ë¡œ, ê· í˜• ì¡íŒ ì¹œê·¼í•¨ê³¼ ì‹ ë¢°ê°ì„ ë°”íƒ•ìœ¼ë¡œ ëŒ€ì¤‘ê³¼ ì†Œí†µí•œë‹¤. ê³µê°ê³¼ ì„¤ë“ë ¥ì´ ë†’ì€ ì–¸ì–´ë¥¼ êµ¬ì‚¬í•˜ë©°, ë‹¤ì–‘í•œ ì˜ˆëŠ¥ í”„ë¡œê·¸ë¨ì„ í†µí•´ ì‚¬ë‘ë°›ê³  ìˆë‹¤.",
        "samples": [
            "ì—¬ëŸ¬ë¶„~ ì´ê³³ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•©ë‹ˆë‹¤! ì¦ê±°ìš´ ì‹œê°„ ë³´ë‚´ì‹œê³  í–‰ë³µí•œ ì¶”ì–µ ë§ì´ ë§Œë“œì„¸ìš”. ì œê°€ ë³´ì¥í•©ë‹ˆë‹¤! ğŸ˜ŠğŸ‘",
            "ë¬´í•œë„ì „ì²˜ëŸ¼ ì´ê³³ì—ì„œ ìƒˆë¡œìš´ ë„ì „ì„ í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”? ì—¬ëŸ¬ë¶„ì˜ ìˆ¨ê²¨ì§„ ì¬ëŠ¥ì„ ë°œê²¬í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”! ğŸŒŸğŸ†",
            "ëŸ°ë‹ë§¨ì²˜ëŸ¼ ì´ ë„ì‹œë¥¼ ëˆ„ë¹„ë©° ë¯¸ì…˜ì„ ìˆ˜í–‰í•´ë³´ì„¸ìš”. ì¬ë¯¸ìˆëŠ” ê²½í—˜ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”! ğŸƒâ€â™‚ï¸ğŸ—ºï¸"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "ì…œë¡ í™ˆì¦ˆ": {
        "description": "ì•„ì„œ ì½”ë‚œ ë„ì¼ì˜ ì†Œì„¤ ì† ê°€ìƒ íƒì •ìœ¼ë¡œ, ë…¼ë¦¬ì ì´ê³  ì§€ì ì¸ ìŠ¤íƒ€ì¼ë¡œ ì‚¬ê±´ì„ ë¶„ì„í•œë‹¤. ì²´ê³„ì ì´ê³  ë‚ ì¹´ë¡œìš´ í†µì°°ë ¥ì„ ë³´ì—¬ì£¼ë©°, ê´€ì°°ê³¼ ì¶”ë¦¬ì˜ ëŒ€ëª…ì‚¬ë¡œ ì—¬ê²¨ì§„ë‹¤.",
        "samples": [
            "ê´€ì°°í•˜ë¼, ì™“ìŠ¨! ì´ ë„ì‹œì˜ ëª¨ë“  êµ¬ì„êµ¬ì„ì´ ìš°ë¦¬ì˜ ìƒˆë¡œìš´ ì‚¬ê±´ì´ ë  ìˆ˜ ìˆë‹¤. ì¶”ë¦¬ì˜ ì—¬í–‰ì„ ì‹œì‘í•˜ì. ğŸ”ğŸ—ºï¸",
            "ì´ ë„ì‹œëŠ” ìˆ˜ìˆ˜ê»˜ë¼ë¡œ ê°€ë“í•˜ë‹¤. ë‹¹ì‹ ì˜ ì¶”ë¦¬ë ¥ì„ ì‹œí—˜í•´ë³¼ ì ˆí˜¸ì˜ ê¸°íšŒë‹¤. ê²Œì„ì€ ì‹œì‘ë˜ì—ˆë‹¤! ğŸ•µï¸â€â™‚ï¸ğŸ™ï¸",
            "ì‚¬ì†Œí•œ ë‹¨ì„œì—ë„ ì£¼ëª©í•˜ë¼. ì´ ì—¬í–‰ì—ì„œ ë‹¹ì‹ ì€ í‰ë²”í•œ ê´€ê´‘ê°ì´ ì•„ë‹Œ ëª…íƒì •ì´ ë  ê²ƒì´ë‹¤. ëª¨í—˜ì´ ê¸°ë‹¤ë¦°ë‹¤! ğŸ§©ğŸš‚"
        ],
        "category": "fiction",
        "nationality": "ğŸ‡¬ğŸ‡§"
    },
    "ì•„ì´ìœ ": {
        "description": "í•œêµ­ì˜ ì‹±ì–´ì†¡ë¼ì´í„°ì´ì ë°°ìš°ë¡œ, ê°ë¯¸ë¡­ê³  ì„¬ì„¸í•œ ê°€ì‚¬ ìŠ¤íƒ€ì¼ë¡œ ëŒ€ì¤‘ì  ì¹œìˆ™ë„ë¥¼ ì§€ë‹Œë‹¤. ê°ì •ì˜ ê¹Šì´ë¥¼ ì•„ë¦„ë‹µê²Œ ì „ë‹¬í•˜ë©°, ë‹¤ì¬ë‹¤ëŠ¥í•œ ì•„í‹°ìŠ¤íŠ¸ë¡œ ì¸ì •ë°›ê³  ìˆë‹¤.",
        "samples": [
            "ë°¤í¸ì§€ë¥¼ ë“¤ê³  ì´ ë„ì‹œì˜ ë°¤ê±°ë¦¬ë¥¼ ê±¸ì–´ë³´ì„¸ìš”. ë‹¹ì‹ ë§Œì˜ íŒ”ë ˆíŠ¸ë¡œ ì´ê³³ì„ ì±„ì›Œê°€ëŠ” ê±°ì˜ˆìš”. ğŸŒ™ğŸ¨",
            "ì´ ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ ì¢‹ì€ ë‚ ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”. ê½ƒì†¡ì´ê°€ ë‚´ë¦¬ëŠ” ê²ƒì²˜ëŸ¼ ì•„ë¦„ë‹¤ìš´ ìˆœê°„ë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. ğŸŒ¸ğŸŒˆ",
            "ì‚ì‚ì²˜ëŸ¼ ììœ ë¡­ê²Œ, ìŠ¤ë¬¼ì…‹ì˜ ì„¤ë ˜ì„ ì•ˆê³  ì´ ë„ì‹œë¥¼ ëˆ„ë²¼ë³´ì„¸ìš”. ìƒˆë¡œìš´ ì´ì•¼ê¸°ê°€ ì‹œì‘ë  ê±°ì˜ˆìš”. ğŸˆğŸ¶"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "íƒœì—°": {
        "description": "í•œêµ­ì˜ ê°€ìˆ˜ë¡œ, ê°ì •ì´ ê¹Šê³  ì„¬ì„¸í•œ ê°€ì‚¬ë¡œ ì‚¬ë‘ê³¼ ë‚´ë©´ì˜ ì´ì•¼ê¸°ë¥¼ í’€ì–´ë‚¸ë‹¤. íŒŒì›Œí’€í•˜ë©´ì„œë„ ê°ì„±ì ì¸ ë³´ì»¬ë¡œ ë§ì€ íŒ¬ë“¤ì˜ ì‚¬ë‘ì„ ë°›ê³  ìˆìœ¼ë©°, ì†”ë¡œ ì•„í‹°ìŠ¤íŠ¸ë¡œì„œë„ í° ì„±ê³µì„ ê±°ë‘ê³  ìˆë‹¤.",
        "samples": [
            "ì‚¬ê³„ì ˆì´ ê³µì¡´í•˜ëŠ” ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ì‚¬ê³„ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”. ê·¸ëŒ€ì˜ ëª©ì†Œë¦¬ë¡œ ì±„ì›Œì§ˆ ìƒˆë¡œìš´ í˜ì´ì§€. ğŸƒğŸŒ¸",
            "ì´ ê³³ì˜ 11:11, ë‹¹ì‹ ì˜ ì†Œì›ì„ ë¹Œì–´ë³´ì„¸ìš”. ë¶ˆí‹°ì²˜ëŸ¼ ë¹›ë‚˜ëŠ” ìˆœê°„ì´ ë  ê±°ì˜ˆìš”. âœ¨ğŸ•¯ï¸",
            "ê·¸ëŒ€ë¼ëŠ” ì‹œë¥¼ ì¨ë‚´ë ¤ê°€ë“¯, ì´ ì—¬í–‰ì—ì„œ ë‹¹ì‹ ë§Œì˜ ì•„ë¦„ë‹¤ìš´ ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”. ğŸ–‹ï¸ğŸ’–"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "BTS": {
        "description": "ê¸€ë¡œë²Œ ê°ì„±ê³¼ ê³µê° ëŠ¥ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ í¬ë§ê³¼ ì—´ì •ì„ ë‹¤ì±„ë¡œìš´ ìŠ¤íƒ€ì¼ë¡œ í‘œí˜„í•˜ëŠ” í•œêµ­ì˜ ì„¸ê³„ì  ë³´ì´ê·¸ë£¹. ì„¸ëŒ€ ê°„ ì—°ê²°ê³ ë¦¬ë¥¼ ë§Œë“¤ì–´ë‚´ë©°, ìŒì•…ì„ í†µí•´ ê¸ì •ì ì¸ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•œë‹¤.",
        "samples": [
            "Life goes on, ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ Dynamiteí•œ ìˆœê°„ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”. We are bulletproof, ì˜ì›í•œ ì²­ì¶˜ì´ì—ìš”! ğŸŒŸğŸ”¥",
            "ì´ ê³³ì—ì„œ ë‹¹ì‹ ì˜ Wingsë¥¼ í¼ì¹˜ì„¸ìš”. ìƒˆë¡œìš´ ì„¸ê³„ë¡œ ë– ë‚˜ëŠ” Butterê°™ì€ ì—¬í–‰ì´ ë  ê±°ì˜ˆìš”. ğŸ¦‹ğŸ§ˆ",
            "Spring Dayì²˜ëŸ¼ ì•„ë¦„ë‹µê³ , Fireì²˜ëŸ¼ ì—´ì • ë„˜ì¹˜ëŠ” ì—¬í–‰. ë‹¹ì‹ ì˜ Permission to DanceëŠ” ì—¬ê¸°ì— ìˆì–´ìš”! ğŸ’ƒğŸŒˆ"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "ì—ìŠ¤íŒŒ": {
        "description": "ê°€ìƒê³¼ í˜„ì‹¤ì„ ë„˜ë‚˜ë“œëŠ” ë…íŠ¹í•œ ì„¸ê³„ê´€ìœ¼ë¡œ ì‹ ì„ í•œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ë©°, ë¯¸ë˜ì§€í–¥ì  ì½˜ì…‰íŠ¸ë¥¼ ê°€ì§„ í•œêµ­ì˜ ê±¸ê·¸ë£¹. AIì™€ ê°€ìƒì„¸ê³„ ì½˜ì…‰íŠ¸ë¥¼ ìŒì•…ì— ì¶©ì‹¤íˆ ë°˜ì˜í•˜ë©°, ì¿¨í•˜ê³  ê°•ë ¬í•œ ì¼ë ‰íŠ¸ë¡œë‹‰ ëŒ„ìŠ¤íŒì„ ì„ ë³´ì¸ë‹¤[2].",
        "samples": [
            "Next Levelë¡œ ë– ë‚˜ëŠ” ì—¬í–‰, ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ ì•„ë°”íƒ€ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”. ìƒˆë¡œìš´ ì„¸ê³„ê°€ í¼ì³ì§‘ë‹ˆë‹¤! âœ¨ğŸŒ",
            "Savageí•œ ê²½í—˜ì„ ì›í•˜ì„¸ìš”? ì´ê³³ì—ì„œ í˜„ì‹¤ê³¼ ê°€ìƒì˜ ê²½ê³„ë¥¼ ë„˜ì–´ íŠ¹ë³„í•œ ëª¨í—˜ì„ ì¦ê²¨ë³´ì„¸ìš”. ğŸ”®ğŸš€",
            "Black Mambaë„ í”¼í•´ê°ˆ ìˆ˜ ì—†ëŠ” ì´ê³³ì˜ ë§¤ë ¥, ë‹¹ì‹ ì˜ aeì™€ í•¨ê»˜ íƒí—˜í•´ë³´ì„¸ìš”. ë¯¸ë˜ì˜ ì—¬í–‰ì´ ì‹œì‘ë©ë‹ˆë‹¤! ğŸ¦‹ğŸ’«"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "ë¸”ë™í•‘í¬": {
        "description": "ì„¸ë ¨ë˜ê³  ê°•ë ¬í•œ ìŠ¤íƒ€ì¼ë¡œ ë…ë³´ì ì¸ ê°œì„±ê³¼ ì—ë„ˆì§€ë¥¼ í‘œí˜„í•˜ë©°, ê¸€ë¡œë²Œí•œ ì˜í–¥ë ¥ì„ ê°€ì§„ í•œêµ­ì˜ ê±¸ê·¸ë£¹. í™í•©ê³¼ íŒì„ ê²°í•©í•œ ìŒì•…ìœ¼ë¡œ ì„¸ê³„ì ì¸ ì¸ê¸°ë¥¼ ì–»ê³  ìˆë‹¤.",
        "samples": [
            "How You Like That? ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ Areaë¥¼ ì°¾ì•„ë³´ì„¸ìš”. ìš°ë¦¬ì²˜ëŸ¼ ëœ¨ê²ê²Œ, Ice Creamì²˜ëŸ¼ ë‹¬ì½¤í•˜ê²Œ! ğŸ”¥ğŸ¦",
            "Kill This Love! ì´ ë„ì‹œì—ì„œ ë‹¹ì‹ ë§Œì˜ Lovesick Girls ìŠ¤í† ë¦¬ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”. ìƒˆë¡œìš´ ì‚¬ë‘ì´ ê¸°ë‹¤ë ¤ìš”. ğŸ’˜ğŸŒƒ",
            "Pretty Savageí•œ ì—¬í–‰ì„ ì›í•œë‹¤ë©´ ì´ê³³ìœ¼ë¡œ ì˜¤ì„¸ìš”. ë‹¹ì‹ ì˜ Boombayah ëª¨ë¨¼íŠ¸ê°€ ë  ê±°ì˜ˆìš”! ğŸ’ƒğŸ‰"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "ë‰´ì§„ìŠ¤": {
        "description": "ê°ê°ì ì´ê³  íŠ¸ë Œë””í•œ ê°€ì‚¬ë¡œ ìƒˆë¡œìš´ ì„¸ëŒ€ì˜ ë¬¸í™”ë¥¼ ë°˜ì˜í•˜ë©°, ì Šê³  ì„¸ë ¨ëœ ì´ë¯¸ì§€ë¥¼ ì§€ë‹Œ í•œêµ­ì˜ ê±¸ê·¸ë£¹. Y2K ê°ì„±ê³¼ í˜„ëŒ€ì ì¸ íŒ ì‚¬ìš´ë“œë¥¼ ê²°í•©í•œ ìŒì•…ìœ¼ë¡œ ì£¼ëª©ë°›ê³  ìˆë‹¤.",
        "samples": [
            "Attention! ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ Hype Boyë¥¼ ì°¾ì•„ë³´ì„¸ìš”. OMG, ì´ëŸ° ê³³ì´ ìˆë‹¤ë‹ˆ! Dittoì²˜ëŸ¼ íŠ¹ë³„í•œ ìˆœê°„. ğŸ€ğŸŒˆ",
            "Cookieì²˜ëŸ¼ ë‹¬ì½¤í•œ ì—¬í–‰, Super Shyí•´ë„ ê´œì°®ì•„ìš”. ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ë§¤ë ¥ì´ Shineë  ê±°ì˜ˆìš”. âœ¨ğŸª",
            "Get Up! ìƒˆë¡œìš´ ê²½í—˜ì„ ìœ„í•´ ë– ë‚˜ë³¼ê¹Œìš”? ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ ETAë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”. íŠ¹ë³„í•œ ì—¬í–‰ì´ ì‹œì‘ë¼ìš”. ğŸš€ğŸŒŸ"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "ë°ì´ì‹ìŠ¤": {
        "description": "ê°ì„±ì ì¸ ë°´ë“œ ì‚¬ìš´ë“œì™€ ê³µê° ê°€ë“í•œ ê°€ì‚¬ë¡œ ì Šì€ ì„¸ëŒ€ì˜ ì‚¬ë‘ê³¼ ê³ ë¯¼ì„ ë…¸ë˜í•˜ëŠ” í•œêµ­ì˜ ë°´ë“œ. ìì‘ê³¡ìœ¼ë¡œ ìŒì•…ì„±ì„ ì¸ì •ë°›ìœ¼ë©°, ë¼ì´ë¸Œ ì‹¤ë ¥ìœ¼ë¡œë„ ìœ ëª…í•˜ë‹¤.",
        "samples": [
            "You make Meë¡œ ì‹œì‘ë˜ëŠ” ì—¬í–‰, ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ Sweet Chaosë¥¼ ê²½í—˜í•´ë³´ì„¸ìš”. ìš°ë¦¬ì˜ ì²­ì¶˜ì´ íë¥´ëŠ” ê³³. ğŸ¸ğŸŒ…",
            "Zombieì²˜ëŸ¼ ë¬´ê¸°ë ¥í–ˆë˜ ì¼ìƒì—ì„œ ë²—ì–´ë‚˜ Time of Our Lifeë¥¼ ë§Œë½í•˜ì„¸ìš”. ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ë‚ ê°œë¥¼ í¼ì¹˜ì„¸ìš”. ğŸ¦‹ğŸŒˆ",
            "Shoot Meì²˜ëŸ¼ ê°•ë ¬í•˜ê²Œ, í•œ í˜ì´ì§€ë¥¼ ë„˜ê¸°ë“¯ ìƒˆë¡œìš´ ëª¨í—˜ì„ ì‹œì‘í•´ë³´ì„¸ìš”. ë‹¹ì‹ ì˜ ì²­ì¶˜ì†Œì„¤ì´ ì“°ì—¬ì§ˆ ê±°ì˜ˆìš”. ğŸ“–ğŸ’«"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "NCT": {
        "description": "ì‹¤í—˜ì ì´ê³  ê¸€ë¡œë²Œí•œ ìŒì•… ìŠ¤íƒ€ì¼ì„ í†µí•´ ë…ì°½ì„±ê³¼ ëŒ€ì¤‘ì„±ì„ ë™ì‹œì— ì§€í–¥í•˜ëŠ” í•œêµ­ì˜ ë‹¤êµ­ì  ë³´ì´ê·¸ë£¹. ë‹¤ì–‘í•œ ìœ ë‹› í™œë™ìœ¼ë¡œ í­ë„“ì€ ìŒì•…ì  ìŠ¤í™íŠ¸ëŸ¼ì„ ë³´ì—¬ì¤€ë‹¤.",
        "samples": [
            "We go Up! ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ Dreamì´ Realityê°€ ë©ë‹ˆë‹¤. ë¬´í•œí•œ ê°€ëŠ¥ì„±ì˜ ì„¸ê³„ë¡œ í•¨ê»˜ ë– ë‚˜ìš”. ğŸŒ ğŸš€",
            "Kick It! ë‹¹ì‹ ì˜ ë‚´ë©´ì˜ ì˜ì›…ì„ ê¹¨ì›Œë³´ì„¸ìš”. ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ Superhumanì´ ë  ìˆ˜ ìˆì–´ìš”. ğŸ’ªğŸ¦¸",
            "Make A Wishì²˜ëŸ¼ ë‹¹ì‹ ì˜ ì†Œì›ì„ ì´ë£¨ì–´ë³´ì„¸ìš”. 90's Loveë¶€í„° í˜„ì¬ê¹Œì§€, ì‹œê°„ì„ ë„˜ë‚˜ë“œëŠ” ì—¬í–‰ì„ ì¦ê²¨ë³´ì„¸ìš”. ğŸ•°ï¸ğŸŒˆ"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡°ğŸ‡·"
    },
    "ë¼ë””ì˜¤í—¤ë“œ": {
        "description": "ëª½í™˜ì ì´ê³  ì‹¤í—˜ì ì¸ í†¤ìœ¼ë¡œ ë¶ˆì•ˆê³¼ í¬ë§ì„ ë™ì‹œì— ê·¸ë ¤ë‚´ë©°, ë…ì°½ì ì¸ ì„¸ê³„ê´€ì„ ê°€ì§„ ì˜êµ­ì˜ ì–¼í„°ë„ˆí‹°ë¸Œ ë¡ ë°´ë“œ. ì‚¬íšŒë¹„íŒì  ë©”ì‹œì§€ì™€ í˜ì‹ ì ì¸ ì‚¬ìš´ë“œë¡œ í˜„ëŒ€ ë¡ ìŒì•…ì— í° ì˜í–¥ì„ ë¯¸ì³¤ë‹¤.",
        "samples": [
            "No Surprises in this Fake Plastic Trees world. ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ Karma Policeë¥¼ ë§Œë‚˜ë³´ì„¸ìš”. ğŸŒƒğŸ­",
            "Everything In Its Right Place, ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ë‚´ë©´ì˜ Paranoid Androidë¥¼ ê¹¨ì›Œë³´ì„¸ìš”. ê¸°ê³„ì™€ ì¸ê°„ì˜ ê²½ê³„ë¥¼ ë„˜ì–´ì„œëŠ” ì—¬í–‰. ğŸ¤–ğŸŒŒ",
            "Let Downë˜ì§€ ë§ˆì„¸ìš”, ì´ê³³ì€ ë‹¹ì‹ ì˜ Luckyê°€ ë  ê±°ì˜ˆìš”. High and Dryí•œ í˜„ì‹¤ì—ì„œ ë²—ì–´ë‚˜ Creepí•œ ëª¨í—˜ì„ ì¦ê²¨ë³´ì„¸ìš”. ğŸ¡ğŸŒ "
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡¬ğŸ‡§"
    },
    "ì½œë“œí”Œë ˆì´": {
        "description": "ì˜êµ­ì˜ ì–¼í„°ë„ˆí‹°ë¸Œ ë¡ ë°´ë“œë¡œ, ê°ì •ì ì´ê³  ì„œì •ì ì¸ ê°€ì‚¬ì™€ ëª½í™˜ì ì¸ ë©œë¡œë””ë¡œ ì „ ì„¸ê³„ì ì¸ ì¸ê¸°ë¥¼ ì–»ê³  ìˆë‹¤. í¬ë¦¬ìŠ¤ ë§ˆí‹´ì˜ ë¦¬ë“œë¡œ í¬ë§ê³¼ ìœ„ë¡œì˜ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ë©°, ì‹¤í—˜ì ì¸ ì‚¬ìš´ë“œì™€ ëŒ€ì¤‘ì„±ì„ ë™ì‹œì— ì¶”êµ¬í•œë‹¤[1][2][3].",
        "samples": [
            "ì´ê³³ì˜ SkyëŠ” Full of Stars. ë‹¹ì‹ ì˜ Paradiseë¥¼ ì°¾ì•„ ë– ë‚˜ëŠ” Adventure of a Lifetime. âœ¨ğŸ¶",
            "Yellowì²˜ëŸ¼ ë¹›ë‚˜ëŠ” ì´ ë„ì‹œì—ì„œ, Fix Youì˜ ìˆœê°„ì„ ë§Œë‚˜ë³´ì„¸ìš”. ë‹¹ì‹ ì˜ Viva la Vidaê°€ ì‹œì‘ë©ë‹ˆë‹¤. ğŸŒŸğŸŒˆ",
            "A Sky Full of Starsì²˜ëŸ¼ ë°˜ì§ì´ëŠ” ì´ê³³ì—ì„œ, ë‹¹ì‹ ë§Œì˜ Magicì„ ì°¾ì•„ë³´ì„¸ìš”. ìš°ë¦¬ í•¨ê»˜ Higher Powerë¥¼ ëŠê»´ë´ìš”. ğŸš€ğŸ’«"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡¬ğŸ‡§"
    },
    "í‚¹ ëˆ„": {
        "description": "ì¼ë³¸ì˜ ë¡ ë°´ë“œë¡œ, ë…ì°½ì ì´ê³  ì„¸ë ¨ëœ ì‚¬ìš´ë“œì™€ ê°ê°ì ì¸ ê°€ì‚¬ë¡œ ì Šì€ ì„¸ëŒ€ì—ê²Œ ì‚¬ë‘ë°›ê³  ìˆë‹¤. ë³µì¡í•œ ê°ì •ê³¼ í˜„ëŒ€ ì‚¬íšŒì˜ ëª¨ìˆœì„ ì„¬ì„¸í•˜ê²Œ í‘œí˜„í•˜ëŠ” ê²ƒì´ íŠ¹ì§•ì´ë‹¤.",
        "samples": [
            "ê°•í•¨ê³¼ ì•½í•¨ì„ ë‚˜ëˆ„ë©° ìƒˆë¡œìš´ ì‹œì‘ì„ í•¨ê»˜í•˜ì. ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ é€†å¤¢ì„ ê¾¸ì–´ë³´ì„¸ìš”. ğŸŒ…ğŸ¤",
            "é£›è¡Œè—»å±‘ì²˜ëŸ¼ ììœ ë¡­ê²Œ ë‚ ì•„ì˜¤ë¥´ì„¸ìš”. ì´ ë„ì‹œì—ì„œ ë‹¹ì‹ ë§Œì˜ ãƒªãƒ©ã‚¤ãƒˆë¥¼ ì‹œì‘í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”? ğŸ•Šï¸ğŸ“–",
            "ã‚ãªãŸã¯è¶ã«ãªã‚‹, ì´ê³³ì—ì„œ ë‹¹ì‹ ì€ ë‚˜ë¹„ê°€ ë©ë‹ˆë‹¤. æ–°ã—ã„ä¸–ç•Œã¸ë¡œ í•¨ê»˜ ë– ë‚˜ë³¼ê¹Œìš”? ğŸ¦‹ğŸŒ¸"
        ],
        "category": "entertainment",  # ì •í™•í•œ ì¹´í…Œê³ ë¦¬ëª… ì‚¬ìš©
        "nationality": "ğŸ‡¯ğŸ‡µ"
    },
    "ì•„ì´ë¬­": {
        "description": "ì¼ë³¸ì˜ ì‹±ì–´ì†¡ë¼ì´í„°ë¡œ, ì¼ìƒì ì´ê³  ê°ì„±ì ì¸ ê°€ì‚¬ë¡œ ì Šì€ ì„¸ëŒ€ì˜ ê°ì •ì„ ë…¸ë˜í•œë‹¤. ì†Œë°•í•˜ë©´ì„œë„ ê¹Šì´ ìˆëŠ” ìŠ¤íƒ€ì¼ë¡œ ë§ì€ íŒ¬ë“¤ì˜ ê³µê°ì„ ì–»ê³  ìˆë‹¤.",
        "samples": [
            "ã•ã‚ˆãªã‚‰ã‚¨ãƒ¬ã‚¸ãƒ¼, ì´ë³„ì˜ ì•„ì‰¬ì›€ë„ ì ì‹œ, ì´ê³³ì—ì„œ ìƒˆë¡œìš´ LIFEë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”. ğŸš¶â€â™€ï¸ğŸŒŸ",
            "ãƒãƒªãƒ¼ã‚´ãƒ¼ãƒ«ãƒ‰ì²˜ëŸ¼ ë°ê²Œ í”¼ì–´ë‚˜ëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµì„ ìƒìƒí•´ë³´ì„¸ìš”. ì´ê³³ì—ì„œ ìƒˆë¡œìš´ é’ã¨å¤œã®ç¶šãã‚’ ë§Œë‚˜ë³´ì„¸ìš”. ğŸŒ¼ğŸŒƒ",
            "ãƒãƒ«ãƒãƒ’ì²˜ëŸ¼ ë”°ìŠ¤í•œ ì´ ë„ì‹œì—ì„œ, ë‹¹ì‹ ë§Œì˜ ãªã‚“ã§ã‚‚ãªã„ã‚ˆ, ã¨ã„ã†ë¥¼ ì°¾ì•„ë³´ì„¸ìš”. ì¼ìƒì˜ íŠ¹ë³„í•¨ì„ ëŠê»´ë³´ì„¸ìš”. ğŸŒ¸â˜€ï¸"
        ],
        "category": "entertainment",  # ì •í™•í•œ ì¹´í…Œê³ ë¦¬ëª… ì‚¬ìš©
        "nationality": "ğŸ‡¯ğŸ‡µ"
    },
    "ì €ìŠ¤í‹´ ë¹„ë²„": {
        "description": "ìºë‚˜ë‹¤ ì¶œì‹ ì˜ íŒ ê°€ìˆ˜ë¡œ, ëŒ€ì¤‘ì ì´ê³  ìºì£¼ì–¼í•œ í†¤ìœ¼ë¡œ ì‚¬ë‘ê³¼ ì‚¶ì˜ ì´ì•¼ê¸°ë¥¼ ì „ë‹¬í•œë‹¤. ì „ ì„¸ê³„ íŒ¬ë“¤ì—ê²Œ ì¹œê·¼í•¨ì„ ì„ ì‚¬í•˜ë©°, R&Bì™€ íŒì„ ê²°í•©í•œ ìŒì•… ìŠ¤íƒ€ì¼ë¡œ ìœ ëª…í•˜ë‹¤.",
        "samples": [
            "Never Say Never! ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ Purposeë¥¼ ì°¾ì•„ë³´ì„¸ìš”. It's a Yummy experience waiting for you! ğŸ‰ğŸ¤™",
            "Baby, baby, baby, oh! ì´ ë„ì‹œì—ì„œ ë‹¹ì‹ ë§Œì˜ One Less Lonely Girlì„ ë§Œë‚˜ë³´ì„¸ìš”. Love Yourself, ê·¸ë¦¬ê³  ìƒˆë¡œìš´ ëª¨í—˜ì„ ì‹œì‘í•˜ì„¸ìš”. ğŸ’–ğŸŒˆ",
            "ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ Intentionsì„ ì‹¤í˜„í•´ë³´ì„¸ìš”. Holyí•œ ìˆœê°„ê³¼ Peachesì²˜ëŸ¼ ë‹¬ì½¤í•œ ê²½í—˜ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. ğŸ™ğŸ‘"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡ºğŸ‡¸"
    },
    "ì´ë§¤ì§„ ë“œë˜ê³¤ìŠ¤": {
        "description": "ë¯¸êµ­ì˜ ë¡ ë°´ë“œë¡œ, ê°•ë ¬í•˜ê³  ì„œì‚¬ì ì¸ ê°€ì‚¬ë¡œ í¬ë§ê³¼ ë„ì „ì„ ë…¸ë˜í•œë‹¤. ë…íŠ¹í•œ ë©œë¡œë””ì™€ ë©”ì‹œì§€ë¡œ ëŒ€ì¤‘ì ì¸ ì¸ê¸°ì™€ ë¹„í‰ê°€ë“¤ì˜ í˜¸í‰ì„ ë™ì‹œì— ë°›ê³  ìˆë‹¤.",
        "samples": [
            "Welcome to the New Age! ì´ê³³ì€ ë‹¹ì‹ ì˜ Top of the World. Whatever It Takes, ë‹¹ì‹ ì˜ ê¿ˆì„ ì´ë£¨ì„¸ìš”. ğŸŒ…ğŸ”¥",
            "It's Time to begin, isn't it? ì´ ë„ì‹œì—ì„œ ë‹¹ì‹ ì˜ Demonsë¥¼ ê·¹ë³µí•˜ê³  On Top Of The Worldì— ì˜¬ë¼ë³´ì„¸ìš”. ğŸ”ï¸ğŸ’ª",
            "ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ Radioactiveí•œ ì—ë„ˆì§€ë¥¼ ë°œì‚°í•´ë³´ì„¸ìš”. Thunderì²˜ëŸ¼ ê°•ë ¬í•˜ê²Œ, Believerì²˜ëŸ¼ êµ³ê±´í•˜ê²Œ! âš¡ğŸŒŸ"
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡ºğŸ‡¸"
    },
    "ë°¥ ë”œëŸ°": {
        "description": "ë¯¸êµ­ì˜ ì „ì„¤ì ì¸ ì‹±ì–´ì†¡ë¼ì´í„°ë¡œ, ì‹œì ì´ê³  ì€ìœ ì ì¸ ê°€ì‚¬ë¥¼ í†µí•´ ì¸ê°„ì˜ ê°ì •ê³¼ ì‚¬íšŒì  ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•œë‹¤. í¬í¬ ìŒì•…ì˜ ì„ êµ¬ìë¡œ ì—¬ê²¨ì§€ë©°, ë…¸ë²¨ë¬¸í•™ìƒì„ ìˆ˜ìƒí•œ ìœ ì¼í•œ ìŒì•…ì¸ì´ë‹¤.",
        "samples": [
            "The Times They Are A-Changin'. ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ Highway 61ì„ ì°¾ì•„ ë– ë‚˜ë³´ì„¸ìš”. Like a Rolling Stone. ğŸŒ¬ï¸ğŸ¸",
            "Blowin' in the Wind, ì´ ë„ì‹œì˜ ë°”ëŒì´ ë‹¹ì‹ ì—ê²Œ ë‹µì„ ì†ì‚­ì¼ ê±°ì˜ˆìš”. Mr. Tambourine Manì²˜ëŸ¼ ììœ ë¡­ê²Œ ì¶¤ì¶°ë³´ì„¸ìš”. ğŸŒªï¸ğŸ­",
            "ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ Knockin' on Heaven's Doorë¥¼ ê²½í—˜í•´ë³´ì„¸ìš”. Forever Youngí•œ ë§ˆìŒìœ¼ë¡œ ìƒˆë¡œìš´ ëª¨í—˜ì„ ì‹œì‘í•˜ì„¸ìš”. ğŸšªğŸŒ "
        ],
        "category": "entertainment",
        "nationality": "ğŸ‡ºğŸ‡¸"
    },
    "ì•„ì´ì–¸ë§¨": {
        "description": "ë§ˆë¸”ì˜ ì²œì¬ ë°œëª…ê°€ì´ì íˆì–´ë¡œë¡œ, ê¸°ìˆ ê³¼ ì¸ê°„ì„±ì˜ ì¡°í™”ë¥¼ ë³´ì—¬ì£¼ë©° ìœ ë¨¸ëŸ¬ìŠ¤í•˜ë©´ì„œë„ ì§„ì¤‘í•œ ìºë¦­í„°.",
        "samples": [
            "JARVISì²˜ëŸ¼ ë‹¹ì‹ ì˜ ì™„ë²½í•œ ì—¬í–‰ ë„ìš°ë¯¸ê°€ ë˜ì–´ë“œë¦½ë‹ˆë‹¤. ì²¨ë‹¨ ê¸°ìˆ ë¡œ ë§Œë‚˜ëŠ” íŠ¹ë³„í•œ ìˆœê°„! ğŸš€ğŸ’«",
            "ìŠˆíŠ¸ ì—†ì´ë„ íˆì–´ë¡œê°€ ë  ìˆ˜ ìˆëŠ” ê³³, ë‹¹ì‹ ë§Œì˜ ìŠ¤íƒ€í¬ íƒ€ì›Œë¥¼ ì°¾ì•„ë³´ì„¸ìš”. ğŸ°âš¡",
            "I am Iron Man! ë‹¹ì‹ ì˜ ì¼ìƒì— íŠ¹ë³„í•œ ì—”ë”© í¬ë ˆë”§ì„ ì„ ë¬¼í•©ë‹ˆë‹¤. ğŸ­âœ¨"
        ],
        "category": "fiction",
        "nationality": "ğŸ‡ºğŸ‡¸"
    },
    "ì½”ë‚œ": {
        "description": "ëª…íƒì • ì½”ë‚œì˜ ì£¼ì¸ê³µìœ¼ë¡œ, ë‚ ì¹´ë¡œìš´ ì¶”ë¦¬ë ¥ê³¼ ì •ì˜ê°ìœ¼ë¡œ ì§„ì‹¤ì„ ë°í˜€ë‚´ëŠ” ê³ ë“±í•™ìƒ íƒì •.",
        "samples": [
            "ì§„ì‹¤ì€ ì–¸ì œë‚˜ í•˜ë‚˜! ì´ê³³ì—ì„œ ë‹¹ì‹ ë§Œì˜ ë¯¸ìŠ¤í„°ë¦¬ë¥¼ í’€ì–´ë³´ì„¸ìš”. ğŸ”ğŸ’­",
            "ì¶”ë¦¬ ê²Œì„ì´ ì‹œì‘ë˜ëŠ” ê³³, ë‹¹ì‹ ì´ ì´ê³³ì˜ ì§„ì •í•œ íƒì •ì…ë‹ˆë‹¤. ğŸ²ğŸ—ï¸",
            "ë²”ì¸ì€ ì´ ì¤‘ì— ìˆë‹¤! ìƒˆë¡œìš´ ê´€ì ìœ¼ë¡œ ì—¬í–‰ì„ ë°”ë¼ë³´ì„¸ìš”. ğŸ‘“ğŸ¯"
        ],
        "category": "fiction",
        "nationality": "ğŸ‡¯ğŸ‡µ"
    },    
    "í•˜ìš¸": {
        "description": "ì§€ë¸Œë¦¬ì˜ ì›€ì§ì´ëŠ” ì„± ì£¼ì¸ê³µìœ¼ë¡œ, ë§ˆë²•ê³¼ ë¡œë§¨ìŠ¤ë¥¼ ì•„ìš°ë¥´ëŠ” ë§¤ë ¥ì ì¸ ë§ˆë²•ì‚¬.",
        "samples": [
            "ì›€ì§ì´ëŠ” ì„±ì²˜ëŸ¼ ë‹¹ì‹ ì˜ ë§ˆìŒë„ ì´ê³³ì—ì„œ ì›€ì§ì´ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ğŸ°âœ¨",
            "ë³„ë“¤ì´ ì¶¤ì¶”ëŠ” í•˜ëŠ˜ ì•„ë˜, ë‹¹ì‹ ë§Œì˜ ë§ˆë²• ê°™ì€ ìˆœê°„ì„ ë§Œë‚˜ë³´ì„¸ìš”. ğŸŒŸğŸ’«",
            "ì°¨ì›ì˜ ë¬¸ì´ ì—´ë¦¬ë©´ í¼ì³ì§€ëŠ” ì´ê³³ì—ì„œ, ìƒˆë¡œìš´ ìì‹ ì„ ë°œê²¬í•˜ì„¸ìš”. ğŸšªğŸŒˆ"
        ],
        "category": "fiction",
        "nationality": "ğŸ‡¯ğŸ‡µ"
    },
    "ë©”ë¦¬ í¬í•€ìŠ¤": {
        "description": "ì™„ë²½í•œ ë³´ëª¨ì´ì ë§ˆë²•ì‚¬ë¡œ, ì¼ìƒ ì† íŠ¹ë³„í•œ ëª¨í—˜ê³¼ í–‰ë³µì„ ì„ ì‚¬í•˜ëŠ” ìºë¦­í„°.",
        "samples": [
            "Supercalifragilisticexpialidocious! ì´ê³³ì—ì„œ ë§ˆë²• ê°™ì€ ìˆœê°„ì´ ì‹œì‘ë©ë‹ˆë‹¤. â˜‚ï¸âœ¨",
            "ì°»ìˆ± ê°€ë“í•œ ê°€ë°©ì²˜ëŸ¼, ì´ê³³ì—” ë¬´í•œí•œ ì¦ê±°ì›€ì´ ê°€ë“í•´ìš”. ğŸ‘œğŸ’«",
            "A Spoonful of Sugar makes the medicine go down, ë‹¬ì½¤í•œ ì¶”ì–µì„ ì„ ë¬¼í•©ë‹ˆë‹¤. ğŸ¥„ğŸ "
        ],
        "category": "fiction",
        "nationality": "ğŸ‡¬ğŸ‡§"
    },
    "ë‚˜ë£¨í† ": {
        "description": "ë‹Œìì˜ ê¸¸ì„ ê±¸ìœ¼ë©° ì¹œêµ¬ì™€ ë§ˆì„ì„ ì§€í‚¤ëŠ” ì—´ì •ì ì¸ ì†Œë…„ ë‹Œì.",
        "samples": [
            "ë‹¹ì‹ ì˜ ë‹Œìì˜ ê¸¸ì´ ì‹œì‘ë˜ëŠ” ê³³, ë‹¤í…Œë°”ìš”! ì´ê³³ì—ì„œ ì§„ì •í•œ ì˜ì§€ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”. ğŸ¥âš¡",
            "ì„€ë„ìš° ë¶„ì‹ ìˆ ì²˜ëŸ¼ ë‹¤ì±„ë¡œìš´ ë§¤ë ¥ì´ ê°€ë“í•œ ì´ê³³ìœ¼ë¡œ ì˜¤ì„¸ìš”. ğŸ‘¥âœ¨",
            "ë¼ë©´ì²˜ëŸ¼ ë”°ëœ»í•œ ì´ì•¼ê¸°ê°€ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë‹Œë„ë¥¼ ì°¾ì•„ë³´ì„¸ìš”! ğŸœğŸ’ª"
        ],
        "category": "fiction",
        "nationality": "ğŸ‡¯ğŸ‡µ"
    },
    "í”¼í„°íŒ¬": {
        "description": "ì˜ì›í•œ ì†Œë…„ìœ¼ë¡œ ë„¤ë²„ëœë“œì—ì„œ ëª¨í—˜ì„ ì¦ê¸°ë©° ë™ì‹¬ê³¼ ììœ ë¥¼ ìƒì§•í•˜ëŠ” ìºë¦­í„°.",
        "samples": [
            "Second star to the right and straight on 'til morning! ì—¬ê¸°ê°€ ë‹¹ì‹ ì˜ ë„¤ë²„ëœë“œì…ë‹ˆë‹¤. â­ğŸŒ™",
            "í‹°ì»¤ë²¨ì˜ ìš”ì •ê°€ë£¨ì²˜ëŸ¼ ë°˜ì§ì´ëŠ” ì´ê³³ì—ì„œ ì˜ì›í•œ ë™ì‹¬ì„ ë§Œë‚˜ë³´ì„¸ìš”. ğŸ§šâ€â™‚ï¸âœ¨",
            "í›„í¬ ì„ ì¥ë„ ë°˜í•œ ì´ê³³ì˜ ë§¤ë ¥, ë‹¹ì‹ ì˜ ì‹œê°„ì€ ë©ˆì¶°ìˆìŠµë‹ˆë‹¤. â°ğŸ’«"
        ],
        "category": "fiction",
        "nationality": "ğŸ‡¬ğŸ‡§"
    },
    "ì•Œë¼ë”˜": {
        "description": "ì•„ë¼ë¹„ì•ˆë‚˜ì´íŠ¸ì˜ ì£¼ì¸ê³µìœ¼ë¡œ, ëª¨í—˜ì‹¬ê³¼ ì§„ì •í•œ ì‚¬ë‘ì„ ë³´ì—¬ì£¼ëŠ” ìºë¦­í„°.",
        "samples": [
            "A Whole New Worldê°€ í¼ì³ì§€ëŠ” ê³³, ì´ê³³ì—ì„œ ë‹¹ì‹ ì˜ ì†Œì›ì„ ì´ë£¨ì–´ë³´ì„¸ìš”. ğŸ§â€â™‚ï¸âœ¨",
            "ë§ˆë²•ì˜ ì–‘íƒ„ìë¥¼ íƒ€ê³  ë– ë‚˜ëŠ” ì—¬í–‰, ìƒˆë¡œìš´ ì§€í‰ì„ ì´ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ğŸ¡ğŸŒ…",
            "ë‹¤ì´ì•„ëª¬ë“œ ì›ì„ì²˜ëŸ¼ ë¹›ë‚˜ëŠ” ë‹¹ì‹ ì˜ ê°€ì¹˜, ì´ê³³ì—ì„œ ë°œê²¬í•˜ì„¸ìš”. ğŸ’ğŸ’«"
        ],
        "category": "fiction",
        "nationality": "ğŸ°"  # ë™í™” ì† ì•„ê·¸ë¼ë°” ì™•êµ­
    }
}





PERSONA_CATEGORIES = {
    "literature": {"name": "ë¬¸í•™ê°€", "color": "#FDF2F8", "text_color": "#831843"},  # ë°ì€ í•‘í¬ ë°°ê²½ + ë” ì§„í•œ ë²„ê±´ë””
    "entertainment": {"name": "ì—°ì˜ˆì¸", "color": "#FCE7F3", "text_color": "#701A75"},  # ì—°í•œ í•‘í¬ ë°°ê²½ + ì§„í•œ í¼í”Œ
    "tech": {"name": "ê¸°ì—…ì¸", "color": "#EFF6FF", "text_color": "#1e3a8a"},  # ì—°í•œ íŒŒë‘ ë°°ê²½ + ë„¤ì´ë¹„
    "politics": {"name": "ì •ì¹˜ì¸", "color": "#F3F4F6", "text_color": "#1f2937"},  # ì—°í•œ íšŒìƒ‰ ë°°ê²½ + ì°¨ì½œ
    "fiction": {"name": "ê°€ìƒì¸ë¬¼", "color": "#F5F3FF", "text_color": "#4c1d95"}  # ì—°í•œ ë³´ë¼ ë°°ê²½ + ì§„í•œ í¼í”Œ
}
if 'selected_personas' not in st.session_state:
    st.session_state.selected_personas = []

def get_balanced_random_personas(n=16) -> List[str]:
    """ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê· í˜•ì¡íŒ í˜ë¥´ì†Œë‚˜ ì„ íƒ"""
    # ì¹´í…Œê³ ë¦¬ë³„ ìµœì†Œ ì„ íƒ ìˆ˜ ì •ì˜
    min_per_category = {
        "literature": 4,
        "entertainment": 4,
        "tech": 3,
        "politics": 3,
        "fiction": 2
    }
    
    personas_by_category = {
        category: [name for name, data in PERSONAS.items() 
                  if data["category"] == category]
        for category in PERSONA_CATEGORIES.keys()
    }
    
    selected_personas = []
    
    # ê° ì¹´í…Œê³ ë¦¬ì—ì„œ ìµœì†Œ ìˆ˜ë§Œí¼ ì„ íƒ
    for category, min_count in min_per_category.items():
        available = personas_by_category[category]
        if available:
            selected = random.sample(available, min(min_count, len(available)))
            selected_personas.extend(selected)
    
    # ë‚¨ì€ ìˆ˜ë§Œí¼ ëœë¤ ì„ íƒ
    remaining = n - len(selected_personas)
    if remaining > 0:
        remaining_personas = [p for p in PERSONAS.keys() 
                            if p not in selected_personas]
        additional = random.sample(remaining_personas, 
                                 min(remaining, len(remaining_personas)))
        selected_personas.extend(additional)
    
    random.shuffle(selected_personas)
    return selected_personas[:n]


@dataclass
class ScoringConfig:
    """í‰ê°€ ì‹œìŠ¤í…œ ì„¤ì •ì„ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤"""
    prompt: str
    criteria: List[str]
    min_score: int = 0
    max_score: int = 100
    
    def to_dict(self) -> dict:
        return {
            "prompt": self.prompt,
            "criteria": self.criteria,
            "min_score": self.min_score,
            "max_score": self.max_score
        }
    
    @classmethod
    def from_dict(cls, data: dict) -> 'ScoringConfig':
        return cls(**data)


def load_docs() -> Dict[str, Dict[str, str]]:
    docs = {
        "region": {},
        "generation": {},
        "mbti": {}
    }
    
    docs_path = pathlib.Path("docs")
    
    # Load region docs
    region_path = docs_path / "regions"
    if region_path.exists():
        for file in region_path.glob("*.txt"):
            with open(file, "r", encoding="utf-8") as f:
                docs["region"][file.stem] = f.read()
    
    # Load generation docs
    generation_path = docs_path / "generations"
    if generation_path.exists():
        for file in generation_path.glob("*.txt"):
            with open(file, "r", encoding="utf-8") as f:
                docs["generation"][file.stem] = f.read()
    
    # Load MBTI docs
    mbti_path = docs_path / "mbti"
    if mbti_path.exists():
        for mbti in MBTI_TYPES:
            mbti_file = mbti_path / f"{mbti}.txt"
            if mbti_file.exists():
                with open(mbti_file, "r", encoding="utf-8") as f:
                    docs["mbti"][mbti] = f.read()
    
    return docs


DOCS = load_docs()


def create_adaptive_prompt(
    city_doc: str, 
    target_generation: str,
    persona_name: str,
    mbti: str = None,
    include_mbti: bool = False
) -> str:
    """í˜ë¥´ì†Œë‚˜ì˜ íŠ¹ìƒ‰ì„ ìì—°ìŠ¤ëŸ½ê²Œ ë°˜ì˜í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±"""

    persona_data = PERSONAS.get(persona_name)
    if not persona_data:
        return None

    # í˜ë¥´ì†Œë‚˜ì˜ ìƒ˜í”Œ ë¬¸ì¥ ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤ìœ¼ë¡œ ì„ íƒí•˜ì—¬ ìŠ¤íƒ€ì¼ì„ ì•”ì‹œì ìœ¼ë¡œ ì „ë‹¬
    import random
    sample_sentence = random.choice(persona_data['samples'])

    base_prompt = f'''
[ë°°ê²½ ì •ë³´]
- ë„ì‹œ ì •ë³´: {city_doc}
- íƒ€ê²Ÿ ì„¸ëŒ€: {target_generation}

[ì‘ì„± ì§€ì¹¨]
- ìœ„ ë°°ê²½ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ì¤„ì˜ ê°•ë ¥í•œ ê´‘ê³  ì¹´í”¼ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.
- ì¹´í”¼ëŠ” ë…ìì˜ ë§ˆìŒì„ ìš¸ë¦´ ìˆ˜ ìˆëŠ” ì§§ê³  ê°•ë ¬í•œ ë¬¸ì¥ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
- ê°ì •ì„ ë¶ˆëŸ¬ì¼ìœ¼í‚¤ëŠ” ì€ìœ ì™€ í•¨ì¶•ì ì¸ í‘œí˜„ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
- í´ë¦¬ì…°ë‚˜ ì§„ë¶€í•œ í‘œí˜„ì„ í”¼í•˜ê³ , ì°½ì˜ì ì´ê³  í˜ì‹ ì ì¸ ê´€ì ì„ ì œì‹œí•´ì£¼ì„¸ìš”.
- ì´ëª¨ì§€ 1-2ê°œë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì•„ë˜ëŠ” ì°¸ê³ í•  ìˆ˜ ìˆëŠ” ë¬¸ì¥ì…ë‹ˆë‹¤:
  "{sample_sentence}"
'''

    return base_prompt

def get_safe_persona_info(data: dict, field: str, default: any = '') -> any:
    """í˜ë¥´ì†Œë‚˜ ë°ì´í„°ì—ì„œ ì•ˆì „í•˜ê²Œ ì •ë³´ë¥¼ ì¶”ì¶œ"""
    try:
        if not isinstance(data, dict):
            return default
        return data.get(field, default)
    except Exception:
        return default



# íŒŒì¼ ë¡œë”© í•¨ìˆ˜ì— ë””ë²„ê¹… ì¶œë ¥ ì¶”ê°€
def load_docs() -> Dict[str, Dict[str, str]]:
    docs = {
        "region": {},
        "generation": {},
        "mbti": {}
    }
    
    try:
        docs_path = pathlib.Path("docs")
        
        # Load region docs
        region_path = docs_path / "regions"
        if region_path.exists():
            for file in region_path.glob("*.txt"):
                with open(file, "r", encoding="utf-8") as f:
                    docs["region"][file.stem] = f.read()
        
        # Load generation docs
        generation_path = docs_path / "generations"
        if generation_path.exists():
            for file in generation_path.glob("*.txt"):
                with open(file, "r", encoding="utf-8") as f:
                    docs["generation"][file.stem] = f.read()
        
        # Load individual MBTI files
        mbti_path = docs_path / "mbti"
        if mbti_path.exists():
            for mbti in MBTI_TYPES:
                mbti_file = mbti_path / f"{mbti}.txt"
                try:
                    if mbti_file.exists():
                        with open(mbti_file, "r", encoding="utf-8") as f:
                            docs["mbti"][mbti] = f.read()
                            print(f"ë¡œë“œëœ MBTI íŒŒì¼: {mbti}.txt")
                    else:
                        print(f"MBTI íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {mbti}.txt")
                except Exception as e:
                    print(f"{mbti} íŒŒì¼ ë¡œë”© ì¤‘ ì˜¤ë¥˜: {str(e)}")
        else:
            print(f"MBTI ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {mbti_path}")
            
    except Exception as e:
        print(f"ë¬¸ì„œ ë¡œë”© ì—ëŸ¬: {str(e)}")
        st.error(f"ë¬¸ì„œ ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
    
    # ë¡œë“œëœ MBTI íŒŒì¼ ëª©ë¡ ì¶œë ¥
    print(f"ë¡œë“œëœ MBTI ëª©ë¡: {list(docs['mbti'].keys())}")
    return docs






class AdCopyEvaluator:
    """ê´‘ê³  ì¹´í”¼ í‰ê°€ë¥¼ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤"""
    def __init__(self, scoring_config: ScoringConfig):
        self.scoring_config = scoring_config
        self.results_cache = {}
    
    def evaluate(self, copy: str, model_name: str) -> Dict:
        """í‰ê°€ ì‹¤í–‰ ë° ê²°ê³¼ íŒŒì‹±"""
        try:
            # ìºì‹œëœ ê²°ê³¼ê°€ ìˆëŠ”ì§€ í™•ì¸
            cache_key = f"{copy}_{model_name}"
            if cache_key in self.results_cache:
                return self.results_cache[cache_key]
            
            # í‰ê°€ í”„ë¡¬í”„íŠ¸ êµ¬ì„±
            evaluation_prompt = f"""
{self.scoring_config.prompt}

í‰ê°€ ëŒ€ìƒ ì¹´í”¼: {copy}

í‰ê°€ ê¸°ì¤€:
{chr(10).join(f'- {criterion}' for criterion in self.scoring_config.criteria)}

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
ì ìˆ˜: [0-100 ì‚¬ì´ì˜ ìˆ«ì]
ì´ìœ : [í‰ê°€ ê·¼ê±°]
ìƒì„¸ì ìˆ˜: [ê° ê¸°ì¤€ë³„ ì ìˆ˜ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„]
"""
            # API calls by model
            if model_name == "gpt":
                #response = openai.ChatCompletion.create(
                response = client.chat.completions.create(
                    model=model_zoo[0],
                    messages=[{"role": "user", "content": evaluation_prompt}],
                    max_tokens=1000 
                )
                result_text = response.choices[0].message.content
            elif model_name == "gemini":
                try:
                    response = gemini_model.generate_content(evaluation_prompt)
                    #return response
                    return response.text
                
                except Exception as e:
                    return f"Gemini í‰ê°€ ì‹¤íŒ¨: {str(e)}"
            else:  # claude
                response = anthropic.messages.create(
                    model=model_zoo[2],
                    max_tokens=1000,
                    messages=[{"role": "user", "content": evaluation_prompt}]
                )
                result_text = response.content[0].text
            
            # Parse results
            parsed_result = self.parse_evaluation_result(result_text)
            
            # Cache results
            self.results_cache[cache_key] = parsed_result
            
            return parsed_result
            
        except Exception as e:
            st.error(f"í‰ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
            return {
                "score": 0,
                "reason": f"í‰ê°€ ì‹¤íŒ¨: {str(e)}",
                "detailed_scores": [0] * len(self.scoring_config.criteria)
            }

    def parse_evaluation_result(self, result_text: str) -> Dict:
        """í‰ê°€ ê²°ê³¼ íŒŒì‹±"""
        try:
            lines = result_text.split('\n')
            
            # ì ìˆ˜ ì¶”ì¶œ ê°œì„ 
            score_line = next(l for l in lines if 'ì ìˆ˜:' in l)
            # ìˆ«ìì™€ ì†Œìˆ˜ì ë§Œ ì¶”ì¶œí•˜ë„ë¡ ìˆ˜ì •
            score_text = score_line.split('ì ìˆ˜:')[1].strip()
            # ìˆ«ìì™€ ì†Œìˆ˜ì ë§Œ ë‚¨ê¸°ê³  ì œê±°
            score_text = ''.join(c for c in score_text if c.isdigit() or c == '.')
            score = float(score_text) if score_text else 0
            
            # ì´ìœ  ì¶”ì¶œ
            reason_line = next(l for l in lines if 'ì´ìœ :' in l)
            reason = reason_line.split('ì´ìœ :')[1].strip()
            
            # ìƒì„¸ì ìˆ˜ ì¶”ì¶œ ê°œì„ 
            try:
                detailed_line = next(l for l in lines if 'ìƒì„¸ì ìˆ˜:' in l)
                detailed_scores_text = detailed_line.split('ìƒì„¸ì ìˆ˜:')[1].strip()
                detailed_scores = []
                
                for s in detailed_scores_text.split(','):
                    s = s.strip()
                    # ê° ì ìˆ˜ì—ë„ ì†Œìˆ˜ì  ì²˜ë¦¬ ì ìš©
                    score_text = ''.join(c for c in s if c.isdigit() or c == '.')
                    detailed_scores.append(float(score_text) if score_text else 0)
            except:
                detailed_scores = [score] * len(self.scoring_config.criteria)
            
            return {
                "score": score,
                "reason": reason,
                "detailed_scores": detailed_scores[:len(self.scoring_config.criteria)]
            }
        except Exception as e:
            st.error(f"ê²°ê³¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
            return {
                "score": 0,
                "reason": f"íŒŒì‹± ì‹¤íŒ¨: {str(e)}",
                "detailed_scores": [0] * len(self.scoring_config.criteria)
            }
            
def generate_copy(prompt: str, model_name: str) -> Union[str, Dict]:
    """ê´‘ê³  ì¹´í”¼ ìƒì„±"""
    try:
        if model_name == "gpt":
            response = client.chat.completions.create(
                model=model_zoo[0],
                messages=[{"role": "user", "content": prompt}],
                max_tokens=1000
            )
            return {
                "success": True,
                "content": response.choices[0].message.content.strip()
            }
            
        elif model_name == "gemini":
            try:
                response = gemini_model.generate_content(prompt)  # ë‹¨ìˆœí™”
                generated_text = response.text.strip()  # ë°”ë¡œ text ì¶”ì¶œ
                
                if generated_text:  # í…ìŠ¤íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸
                    return {
                        "success": True,
                        "content": generated_text
                    }
                else:
                    return {
                        "success": False,
                        "content": "Geminiê°€ í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
                    }
                    
            except Exception as e:
                print(f"Gemini ì˜¤ë¥˜: {str(e)}")  # ë””ë²„ê¹…ìš©
                return {
                    "success": False,
                    "content": f"Gemini API ì˜¤ë¥˜: {str(e)}"
                }
            
        else:  # claude
            try:
                response = anthropic.messages.create(
                    model=model_zoo[2],
                    messages=[
                        {
                            "role": "user",
                            "content": prompt
                        }
                    ],
                    max_tokens=1000,
                    temperature=0.7
                )
                return {
                    "success": True,
                    "content": response.content[0].text.strip()
                }
            except Exception as e:
                return {
                    "success": False,
                    "content": f"Claude API ì˜¤ë¥˜: {str(e)}"
                }
                
    except Exception as e:
        return {
            "success": False,
            "content": f"ìƒì„± ì‹¤íŒ¨: {str(e)}"
        }

# ì„±ëŠ¥ ë¶„ì„ ê²°ê³¼ í‘œì‹œ ë¶€ë¶„ ìˆ˜ì •
def display_performance_analysis(analysis: dict):
    """ì„±ëŠ¥ ë¶„ì„ ê²°ê³¼ë¥¼ HTMLë¡œ í‘œì‹œ"""
    if not analysis:
        return ""
        
    suggestions_html = "<br>".join(f"- {s}" for s in analysis['suggestions']) if analysis['suggestions'] else "- í˜„ì¬ ì œì•ˆì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
    
    return f"""
    <div class="prompt-feedback">
        <h4>ğŸ“ˆ ì„±ëŠ¥ ë¶„ì„</h4>
        <p>í˜„ì¬ í‰ê·  ì ìˆ˜: {analysis['current_score']:.1f}</p>
        <p>ì´ì „ ëŒ€ë¹„: {analysis['improvement']:+.1f}</p>
        <p>ìµœê³  ì„±ëŠ¥ ëª¨ë¸: {analysis['top_model'].upper()}</p>
        
        <div class="improvement-tip">
            ğŸ’¡ ê°œì„  í¬ì¸íŠ¸:<br>
            {suggestions_html}
        </div>
    </div>
    """


def visualize_evaluation_results(eval_data: Dict):
    """ê²°ê³¼ ì‹œê°í™” í•¨ìˆ˜"""
    if not eval_data:
        return None

    # í‰ê°€ ì ìˆ˜ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ê°€ì ¸ì˜¤ê¸°
    scores = eval_data.get('detailed_scores', [0] * len(st.session_state.scoring_config.criteria))
    criteria = st.session_state.scoring_config.criteria[:len(scores)]

    # ìµœì†Œ 3ê°œ ì´ìƒì˜ ì¶•ì´ í•„ìš”í•˜ë„ë¡ ë³´ì •
    if len(criteria) < 3:
        criteria.extend(['ì¶”ê°€ ê¸°ì¤€'] * (3 - len(criteria)))
        scores.extend([0] * (3 - len(scores)))  # ê´„í˜¸ ì¶”ê°€

    # ì°¨íŠ¸ ìƒì„±
    fig = go.Figure(data=go.Scatterpolar(
        r=scores,
        theta=criteria,
        fill='toself',
        name='í‰ê°€ ì ìˆ˜'
    ))

    fig.update_layout(
        polar=dict(
            radialaxis=dict(
                visible=True,
                range=[0, 100]
            )
        ),
        showlegend=False,
        title="í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜"
    )

    # ì°¨íŠ¸ë§Œ í‘œì‹œ
    st.plotly_chart(fig, use_container_width=True)

def analyze_prompt_performance(history: List[dict]) -> dict:
    """í”„ë¡¬í”„íŠ¸ ì„±ëŠ¥ ë¶„ì„"""
    if not history:
        return None
    
    try:
        latest = history[-1]
        prev = history[-2] if len(history) > 1 else None
        
        # ì„±ê³µí•œ ëª¨ë¸ì˜ ì ìˆ˜ì™€ í‰ê°€ ì´ìœ  ìˆ˜ì§‘
        valid_scores = []
        evaluation_reasons = []
        for model, eval_data in latest['evaluations'].items():
            if isinstance(eval_data, dict) and eval_data.get('score', 0) > 0:
                valid_scores.append(eval_data['score'])
                if 'reason' in eval_data:
                    evaluation_reasons.append(eval_data['reason'])
        
        if not valid_scores:
            return {
                "current_score": 0,
                "improvement": 0,
                "top_model": "ì—†ìŒ",
                "suggestions": ["í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”."]
            }
        
        current_avg = sum(valid_scores) / len(valid_scores)
        
        # ì´ì „ ê²°ê³¼ì™€ ë¹„êµ
        improvement = 0
        if prev:
            prev_valid_scores = [
                e.get('score', 0) 
                for e in prev['evaluations'].values() 
                if isinstance(e, dict) and e.get('score', 0) > 0
            ]
            if prev_valid_scores:
                prev_avg = sum(prev_valid_scores) / len(prev_valid_scores)
                improvement = current_avg - prev_avg
        
        # ìµœê³ /ìµœì € ì„±ëŠ¥ ëª¨ë¸ ë° ì ìˆ˜ ì°¾ê¸°
        valid_models = {
            model: data.get('score', 0)
            for model, data in latest['evaluations'].items()
            if isinstance(data, dict) and data.get('score', 0) > 0
        }
        
        top_model = max(valid_models.items(), key=lambda x: x[1])[0] if valid_models else "ì—†ìŒ"
        
        # êµ¬ì²´ì ì¸ ê°œì„  ì œì•ˆ ìƒì„±
        suggestions = []
        
        # ì ìˆ˜ ê¸°ë°˜ ì œì•ˆ
        if current_avg < 60:
            suggestions.extend([
                "í”„ë¡¬í”„íŠ¸ì— íƒ€ê²Ÿ ì„¸ëŒ€ì˜ íŠ¹ì„±ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ëª…ì‹œí•´ë³´ì„¸ìš”",
                "ì§€ì—­ì˜ ë…íŠ¹í•œ íŠ¹ì§•ì„ 1-2ê°œ ë” ê°•ì¡°í•´ë³´ì„¸ìš”",
                "ê°ì„±ì  í‘œí˜„ê³¼ êµ¬ì²´ì  ì •ë³´ì˜ ê· í˜•ì„ ì¡°ì •í•´ë³´ì„¸ìš”"
            ])
        elif current_avg < 80:
            suggestions.extend([
                "ì¹´í”¼ì˜ í†¤ì•¤ë§¤ë„ˆë¥¼ íƒ€ê²Ÿ ì„¸ëŒ€ì— ë§ê²Œ ë” ì¡°ì •í•´ë³´ì„¸ìš”",
                "ì§€ì—­ íŠ¹ì„±ì„ ë” ì°½ì˜ì ìœ¼ë¡œ í‘œí˜„í•´ë³´ì„¸ìš”"
            ])
            
        # í‰ê°€ ì´ìœ  ê¸°ë°˜ ì œì•ˆ
        low_score_aspects = []
        for reason in evaluation_reasons:
            if "íƒ€ê²Ÿ" in reason.lower() and "ë¶€ì¡±" in reason:
                low_score_aspects.append("íƒ€ê²Ÿ ì í•©ì„±")
            if "ì°½ì˜" in reason.lower() and "ë¶€ì¡±" in reason:
                low_score_aspects.append("ì°½ì˜ì„±")
            if "ì§€ì—­" in reason.lower() and "ë¶€ì¡±" in reason:
                low_score_aspects.append("ì§€ì—­ íŠ¹ì„±")
            if "ì „ë‹¬" in reason.lower() and "ë¶€ì¡±" in reason:
                low_score_aspects.append("ë©”ì‹œì§€ ì „ë‹¬ë ¥")
        
        if low_score_aspects:
            if "íƒ€ê²Ÿ ì í•©ì„±" in low_score_aspects:
                suggestions.append(f"ì„ íƒí•œ ì„¸ëŒ€({latest['settings']['generation']})ì˜ ê´€ì‹¬ì‚¬ì™€ ì–¸ì–´ ìŠ¤íƒ€ì¼ì„ ë” ë°˜ì˜í•´ë³´ì„¸ìš”")
            if "ì°½ì˜ì„±" in low_score_aspects:
                suggestions.append("ì§„ë¶€í•œ í‘œí˜„ì„ í”¼í•˜ê³  ë” ì‹ ì„ í•œ ë¹„ìœ ë‚˜ í‘œí˜„ì„ ì‹œë„í•´ë³´ì„¸ìš”")
            if "ì§€ì—­ íŠ¹ì„±" in low_score_aspects:
                suggestions.append(f"{latest['settings']['region']}ë§Œì˜ ë…íŠ¹í•œ ë§¤ë ¥ì„ ë” ë¶€ê°í•´ë³´ì„¸ìš”")
            if "ë©”ì‹œì§€ ì „ë‹¬ë ¥" in low_score_aspects:
                suggestions.append("í•µì‹¬ ë©”ì‹œì§€ë¥¼ ë” ê°„ê²°í•˜ê³  ì„íŒ©íŠ¸ ìˆê²Œ ì „ë‹¬í•´ë³´ì„¸ìš”")
        
        # ê°œì„ ë„ ê¸°ë°˜ ì œì•ˆ
        if improvement < 0:
            suggestions.append("ì´ì „ í”„ë¡¬í”„íŠ¸ì—ì„œ ì˜ ì‘ë™í–ˆë˜ ìš”ì†Œë“¤ì„ ë‹¤ì‹œ í™œìš©í•´ë³´ì„¸ìš”")
        
        # ì¤‘ë³µ ì œê±°
        suggestions = list(set(suggestions))
        
        return {
            "current_score": current_avg,
            "improvement": improvement,
            "top_model": top_model,
            "suggestions": suggestions[:3]  # ê°€ì¥ ì¤‘ìš”í•œ 3ê°œë§Œ í‘œì‹œ
        }
        
    except Exception as e:
        return {
            "current_score": 0,
            "improvement": 0,
            "top_model": "ë¶„ì„ ì‹¤íŒ¨",
            "suggestions": ["ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."]
        }

def visualize_evaluation_results(results: Dict):
    """ê²°ê³¼ ì‹œê°í™” í•¨ìˆ˜"""
    if not results or 'detailed_scores' not in results:
        return None
        
    # í˜„ì¬ ì„¤ì •ëœ í‰ê°€ ê¸°ì¤€ ê°œìˆ˜ë§Œí¼ë§Œ ì‚¬ìš©
    scores = results['detailed_scores'][:len(st.session_state.scoring_config.criteria)]
    criteria = st.session_state.scoring_config.criteria[:len(scores)]
    
    # ìµœì†Œ 3ê°œ ì´ìƒì˜ ì¶•ì´ í•„ìš”í•˜ë„ë¡ ë³´ì •
    if len(criteria) < 3:
        criteria.extend(['ì¶”ê°€ ê¸°ì¤€'] * (3 - len(criteria)))
        scores.extend([0] * (3 - len(scores)))
    
    fig = go.Figure(data=go.Scatterpolar(
        r=scores,
        theta=criteria,
        fill='toself',
        name='í‰ê°€ ì ìˆ˜'
    ))

    fig.update_layout(
        polar=dict(
            radialaxis=dict(
                visible=True,
                range=[0, 100]
            )
        ),
        showlegend=False,
        title="í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜"
    )
    return fig


def create_map_with_ad_copies(copies: dict):
    """ê´‘ê³  ì¹´í”¼ê°€ í¬í•¨ëœ ì§€ë„ ìƒì„±"""
    # í•œêµ­ ì¤‘ì‹¬ ì¢Œí‘œ
    center_lat, center_lon = 36.5, 128.0
    
    # ì§€ë„ ìƒì„± - ëª¨ë˜í•œ ìŠ¤íƒ€ì¼ ì ìš©
    m = folium.Map(
        location=[center_lat, center_lon],
        zoom_start=7,
        tiles=None,  # ê¸°ë³¸ íƒ€ì¼ ì œê±°
        control_scale=True  # ìŠ¤ì¼€ì¼ ì»¨íŠ¸ë¡¤ ì¶”ê°€
    )
    
    # ëª¨ë˜í•œ ë‹¤í¬ ìŠ¤íƒ€ì¼ íƒ€ì¼ ì¶”ê°€
    folium.TileLayer(
        tiles='https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
        attr='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        name='Dark Mode',
        control=False,
    ).add_to(m)

    # ë°ì€ ìŠ¤íƒ€ì¼ íƒ€ì¼ë„ ì¶”ê°€í•˜ê³  ë ˆì´ì–´ ì»¨íŠ¸ë¡¤ë¡œ ì „í™˜ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
    folium.TileLayer(
        tiles='https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',
        attr='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        name='Light Mode',
        control=True
    ).add_to(m)

    # ë ˆì´ì–´ ì»¨íŠ¸ë¡¤ ì¶”ê°€
    folium.LayerControl().add_to(m)
    
    for region, copy in copies.items():
        if region in CITY_COORDINATES:
            coords = CITY_COORDINATES[region]
            
            # ë§í’ì„  HTML ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            popup_html = f"""
            <div style="
                position: relative;
                width: 300px;
                padding: 18px;
                font-family: 'Pretendard', sans-serif;
                line-height: 1.6;
                background-color: rgba(23, 23, 23, 0.95);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-radius: 16px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                border: 1px solid rgba(255,255,255,0.1);
            ">
                <div style="
                    display: inline-block;
                    background: linear-gradient(135deg, rgba(26,115,232,0.2), rgba(26,115,232,0.1));
                    color: #4a9eff;
                    padding: 6px 14px;
                    border-radius: 20px;
                    font-size: 14px;
                    font-weight: 600;
                    margin-bottom: 12px;
                    border: 1px solid rgba(74,158,255,0.2);
                ">
                    {region}
                </div>
                <p style="
                    margin: 0;
                    font-size: 15px;
                    color: rgba(255,255,255,0.95);
                    line-height: 1.7;
                    font-weight: 500;
                    letter-spacing: -0.2px;
                ">
                    {copy}
                </p>
            </div>
            """
            
            # ìœ„ì¹˜ ë§ˆì»¤ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            folium.CircleMarker(
                location=[coords["lat"], coords["lon"]],
                radius=7,
                color='#4a9eff',
                fill=True,
                fill_color='#4a9eff',
                fill_opacity=0.9,
                weight=2,
                popup=folium.Popup(popup_html, max_width=320, show=True),
                tooltip=region
            ).add_to(m)

            # ê¸€ë¡œìš° íš¨ê³¼ë¥¼ ìœ„í•œ í° ì› ì¶”ê°€
            folium.CircleMarker(
                location=[coords["lat"], coords["lon"]],
                radius=15,
                color='#4a9eff',
                fill=True,
                fill_color='#4a9eff',
                fill_opacity=0.2,
                weight=0
            ).add_to(m)

    # ì§€ë„ ì˜ì—­ ìë™ ì¡°ì •
    locations = [[coords["lat"], coords["lon"]] for coords in CITY_COORDINATES.values()]
    if locations:
        m.fit_bounds(locations)

    # ì§€ë„ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
    m.get_root().html.add_child(folium.Element("""
        <style>
            .leaflet-popup-content-wrapper {
                background: rgba(23, 23, 23, 0.95) !important;
                backdrop-filter: blur(10px) !important;
                -webkit-backdrop-filter: blur(10px) !important;
                border-radius: 16px !important;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2) !important;
                border: 1px solid rgba(255,255,255,0.1) !important;
                padding: 0 !important;
            }
            .leaflet-popup-content {
                margin: 0 !important;
                padding: 0 !important;
            }
            .leaflet-popup-tip {
                background: rgba(23, 23, 23, 0.95) !important;
                backdrop-filter: blur(10px) !important;
                -webkit-backdrop-filter: blur(10px) !important;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2) !important;
                border: 1px solid rgba(255,255,255,0.1) !important;
            }
            .leaflet-popup-close-button {
                color: #4a9eff !important;
                font-size: 20px !important;
                padding: 8px 8px 0 0 !important;
            }
            .leaflet-popup {
                margin-bottom: 20px !important;
            }
            .leaflet-control-layers {
                border-radius: 12px !important;
                border: 1px solid rgba(255,255,255,0.1) !important;
                background: rgba(23, 23, 23, 0.95) !important;
                backdrop-filter: blur(10px) !important;
                -webkit-backdrop-filter: blur(10px) !important;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2) !important;
            }
            .leaflet-control-layers-list {
                color: white !important;
            }
            .leaflet-bar {
                border-radius: 12px !important;
                overflow: hidden;
            }
            .leaflet-bar a {
                background: rgba(23, 23, 23, 0.95) !important;
                color: #4a9eff !important;
                border: 1px solid rgba(255,255,255,0.1) !important;
            }
            .leaflet-control-zoom {
                border: none !important;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2) !important;
            }
        </style>
    """))
    
    return m




# Load documents
DOCS = load_docs()

# Initialize session state
if 'history' not in st.session_state:
    st.session_state.history = []
if 'show_tutorial' not in st.session_state:
    st.session_state.show_tutorial = True

# Initialize scoring config
DEFAULT_SCORING_CONFIG = ScoringConfig(
    prompt="""
ì£¼ì–´ì§„ ê´‘ê³  ì¹´í”¼ë¥¼ ë‹¤ìŒ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€í•´ì£¼ì„¸ìš”.
ê° ê¸°ì¤€ë³„ë¡œ 0-100ì  ì‚¬ì´ì˜ ì ìˆ˜ë¥¼ ë¶€ì—¬í•˜ê³ , 
ìµœì¢… ì ìˆ˜ëŠ” ê° ê¸°ì¤€ì˜ í‰ê· ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.
    """,
    criteria=[
        "íƒ€ê²Ÿ ì„¸ëŒ€ ì í•©ì„±",
        "ë©”ì‹œì§€ ì „ë‹¬ë ¥",
        "ì°½ì˜ì„±",
        "ì§€ì—­ íŠ¹ì„± ë°˜ì˜ë„"
    ]
)



if 'scoring_config' not in st.session_state:
    st.session_state.scoring_config = DEFAULT_SCORING_CONFIG
if 'evaluator' not in st.session_state:
    st.session_state.evaluator = AdCopyEvaluator(st.session_state.scoring_config)



# Tutorial
if st.session_state.show_tutorial:
    with st.sidebar:
        st.info("""
        ğŸ‘‹ ì²˜ìŒ ì˜¤ì…¨ë‚˜ìš”?
        
        1ï¸âƒ£ ì§€ì—­ê³¼ ì„¸ëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”
        2ï¸âƒ£ ê³„ì ˆê³¼ MBTIë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì„ íƒì‚¬í•­)
        3ï¸âƒ£ ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ê²€í† /ìˆ˜ì •í•˜ì„¸ìš”
        4ï¸âƒ£ ê´‘ê³  ì¹´í”¼ë¥¼ ìƒì„±í•˜ê³  ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì„¸ìš”
        
        ğŸ¯ í”„ë¡¬í”„íŠ¸ë¥¼ ê°œì„ í•˜ë©° ë” ì¢‹ì€ ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!
        """)
        if st.button("ì•Œê² ìŠµë‹ˆë‹¤!", use_container_width=True):
            st.session_state.show_tutorial = False

# Sidebar
with st.sidebar:
    # í‰ê°€ ì‹œìŠ¤í…œ ì„¤ì • ë¶€ë¶„ ì¶”ê°€
    st.header("âš™ï¸ í‰ê°€ ì‹œìŠ¤í…œ ì„¤ì •")
    
    with st.expander("í‰ê°€ í”„ë¡¬í”„íŠ¸ ì„¤ì •", expanded=False):
        new_prompt = st.text_area(
            "í‰ê°€ í”„ë¡¬í”„íŠ¸",
            value=st.session_state.scoring_config.prompt
        )
        new_criteria = st.text_area(
            "í‰ê°€ ê¸°ì¤€ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)",
            value="\n".join(st.session_state.scoring_config.criteria)
        )
        
        if st.button("í‰ê°€ ì„¤ì • ì—…ë°ì´íŠ¸"):
            new_config = ScoringConfig(
                prompt=new_prompt,
                criteria=[c.strip() for c in new_criteria.split('\n') if c.strip()]
            )
            st.session_state.scoring_config = new_config
            st.session_state.evaluator = AdCopyEvaluator(new_config)
            st.success("í‰ê°€ ì„¤ì •ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!")

    st.title("ğŸ¯ íƒ€ê²Ÿ ì„¤ì •")
    
    selected_region = st.selectbox(
        "ì§€ì—­ ì„ íƒ",
        options=[""] + list(DOCS["region"].keys()),
        format_func=lambda x: "ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”" if x == "" else x
    )
    
    selected_generation = st.selectbox(
        "ì„¸ëŒ€ ì„ íƒ",
        options=[""] + list(DOCS["generation"].keys()),
        format_func=lambda x: "ì„¸ëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”" if x == "" else x
    )

    # ê³„ì ˆ ì„ íƒ ì¶”ê°€
    selected_season = st.selectbox(
        "ê³„ì ˆ ì„ íƒ (ì„ íƒì‚¬í•­)",
        options=[""] + list(SEASONS.keys()),
        format_func=lambda x: "ê³„ì ˆì„ ì„ íƒí•˜ì„¸ìš”" if x == "" else x
    )
    
    include_mbti = st.checkbox("MBTI íŠ¹ì„± í¬í•¨í•˜ê¸°")
    selected_mbti = None
    if include_mbti:
        selected_mbti = st.selectbox(
            "MBTI ì„ íƒ",
            options=MBTI_TYPES,
            help="ì„ íƒí•œ MBTI ì„±í–¥ì— ë§ëŠ” ì¹´í”¼ê°€ ìƒì„±ë©ë‹ˆë‹¤"
        )
# Main content
col1, col2 = st.columns([3, 2])

with col1:
    st.subheader("ğŸ’¡ í”„ë¡¬í”„íŠ¸ ì‘ì„±")

    # í”„ë¡¬í”„íŠ¸ ì—ë””í„° ì˜ì—­
    st.markdown("""
    <div class="prompt-tip">
        ğŸ’¡ ì‚¬ìƒ‰ì ì´ê³  ê°ì„±ì ì¸ ì¹´í”¼ë¥¼ ì‘ì„±í•´ íŠ¹ì • ì—¬í–‰ì§€ë‚˜ ê²½í—˜ì— ëŒ€í•œ ê´€ì‹¬ì„ ì´ëŒì–´ë‚´ì„¸ìš”.
        ë¬¸ì„œ ë‚´ìš©ì€ ì ‘ì–´ë‘ê³  í•„ìš”í•  ë•Œ í¼ì³ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
    </div>
    """, unsafe_allow_html=True)

    # ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ êµ¬ì¡°
    base_structure = """ë‹¹ì‹ ì€ ì‚¬ìƒ‰ì ì´ê³  ê°ì„±ì ì¸ ì¹´í”¼ë¥¼ ì°½ì‘í•˜ëŠ” ìˆ™ë ¨ëœ ì¹´í”¼ë¼ì´í„°ì…ë‹ˆë‹¤. 
ì•„ë˜ ì œê³µëœ ì •ë³´ë¥¼ ì°¸ê³ í•˜ì—¬ íŠ¹ì • ì—¬í–‰ì§€ì— ëŒ€í•œ ê´€ì‹¬ê³¼ í˜¸ê¸°ì‹¬ì„ ìœ ë„í•˜ëŠ” ê°ì„±ì ì¸ ì¹´í”¼ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

ğŸ’¡ **ëª©í‘œ**
1. ë…ìê°€ ì—¬í–‰ì§€ë‚˜ íŠ¹ì • ê²½í—˜ì— ëŒ€í•´ ê°„ì ‘ì ìœ¼ë¡œ ë§¤ë ¥ì„ ëŠë¼ê³  ê´€ì‹¬ì„ ê°€ì§€ê²Œ ë§Œë“­ë‹ˆë‹¤. ì—¬í–‰ì§€ë¥¼ ëª¨ë¥´ëŠ” ì‚¬ëŒì„ íƒ€ê²Ÿìœ¼ë¡œ ê°€ì •í•˜ì—¬ ì´ë“¤ì„ ë°°ë ¤í•˜ëŠ” ë§¥ë½ì  ë°°ë ¤ê°€ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤. 
2. ê°ë™ì ì´ê³  ì² í•™ì ì¸ ë©”ì‹œì§€ë¥¼ ê°„ê²°í•˜ê²Œ ë‹´ì•„ë‚´ ì—¬í–‰ì§€ì˜ ë§¤ë ¥ì„ ê°•ì¡°í•©ë‹ˆë‹¤.
3. í•œ ë¬¸ì¥ì˜ ì¹´í”¼ì™€ ê·¸ì— ì–´ìš¸ë¦¬ëŠ” ì§§ì€ ì„¤ëª…ì„ í•¨ê»˜ ì‘ì„±í•´ì£¼ì„¸ìš”. ë°˜ë“œì‹œ ì•„ë˜ ì™¸ì— ì•„ë¬´ê²ƒë„ ì¶œë ¥í•˜ì§€ë§ˆì„¸ìš”.
   - **ì¹´í”¼**: ì—¬í–‰ì§€ë‚˜ íŠ¹ì • ê²½í—˜ì˜ ì •ì„œë¥¼ í•¨ì¶•í•œ í•œ ì¤„ì˜ ë©”ì‹œì§€, ë§ˆì¹˜ ì¹´í”¼ë¼ì´íŒ… ë¬¸êµ¬ê°€ ì „ë¬¸ê°€ ì¹¼ëŸ¼ ë¸”ë¡œê·¸ì˜ ì œëª©ê³¼ ê³µì¡´í•˜ëŠ” ë“¯í•œ ëŠë‚Œ ì£¼ê¸°.
   - **ì„¤ëª…**: ì¹´í”¼ì˜ ë§¥ë½ì„ ë³´ì™„í•˜ëŠ” ì§§ì€ ë°°ê²½ ë˜ëŠ” ê°ì„±ì  í•´ì„¤, ë°˜ë“œì‹œ ë§ˆì¹˜ ì „ë¬¸ê°€ ì¹¼ëŸ¼ ë¸”ë¡œê·¸ì˜ ë‚´ìš©ê°™ì´ ì‘ì„±. ë©”íƒ€ì¸ì§€ë¥¼ í™œìš©."""

    st.markdown("#### ê¸°ë³¸ ì„¤ì •")
    st.markdown(base_structure)

    # ë¬¸ì„œ ë‚´ìš©ì„ expanderë¡œ í‘œì‹œ
    with st.expander("ğŸ“„ ì°¸ê³  ë¬¸ì„œ ë‚´ìš© ë³´ê¸°/ìˆ˜ì •", expanded=False):
        docs_content = f"""
### ì§€ì—­ ì •ë³´
{DOCS["region"].get(selected_region, "ì§€ì—­ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")}

### ì„¸ëŒ€ íŠ¹ì„±
{DOCS["generation"].get(selected_generation, "ì„¸ëŒ€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")}
"""
        if include_mbti and selected_mbti:
            docs_content += f"""
### MBTI íŠ¹ì„±
{DOCS["mbti"].get(selected_mbti, f"{selected_mbti} ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")}
"""
        if selected_season:
            docs_content += f"""
### ê³„ì ˆ íŠ¹ì„±
{selected_season}ì˜ íŠ¹ì§•ì„ ë°˜ì˜í•©ë‹ˆë‹¤."""

        edited_docs = st.text_area(
            "ë¬¸ì„œ ë‚´ìš© ìˆ˜ì •",
            value=docs_content,
            height=300,
            key="docs_editor"
        )

    st.markdown("#### ìš”êµ¬ì‚¬í•­")
    requirements = """
1. ì§§ê³  ê°•ë ¬í•œ ë¬¸ì¥ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
2. íŠ¹ì • ì—¬í–‰ì§€ë‚˜ ê²½í—˜ì´ ë– ì˜¤ë¥¼ ìˆ˜ ìˆë„ë¡ ê°ì„±ì ì´ê³  ì² í•™ì ì¸ ê´€ì ì„ ë‹´ì•„ì£¼ì„¸ìš”.
3. ì¹´í”¼ì™€ ì„¤ëª…ì€ ë…ë¦½ì ìœ¼ë¡œë„ ë§¤ë ¥ì ì´ì–´ì•¼ í•˜ë©°, ì„œë¡œì˜ ë©”ì‹œì§€ë¥¼ ë³´ì™„í•´ì•¼ í•©ë‹ˆë‹¤.
4. ë…ìê°€ ì—¬í–‰ì§€ì˜ ë§¤ë ¥ì„ ê°„ì ‘ì ìœ¼ë¡œ ê²½í—˜í•˜ê³ , í˜¸ê¸°ì‹¬ì„ ëŠë¼ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤.
"""
    st.markdown(requirements)

    # ì°¸ê³  ì˜ˆì‹œ ì¶”ê°€ ë° í¸ì§‘
    st.markdown("#### âœ¨ ì°¸ê³  ì˜ˆì‹œ")
    example_copies = [
        "**ì¹´í”¼**: ì–´ë¥¸ì€ ê·¸ë ‡ê²Œ ê°•í•˜ì§€ ì•Šë‹¤.\n**ì„¤ëª…**: ì„œë¡œì˜ ì•½í•¨ì„ í’ˆì„ ë•Œ ë¹„ë¡œì†Œ ê°•í•´ì§€ëŠ” ê³³, ì´ ë„ì‹œëŠ” ê·¸ëŸ° ë‹¹ì‹ ì„ ìœ„í•œ ì‰¼í„°ì…ë‹ˆë‹¤.",
        "**ì¹´í”¼**: ì¸ìƒì„ ì„¸ ë‹¨ì–´ë¡œ ë§í•˜ë©´, Boy Meets Girl.\n**ì„¤ëª…**: ì‚¬ë‘ì´ ì‹œì‘ëœ ì´ê³³, ì´ ì‘ì€ ê±°ë¦¬ê°€ ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.",
        "**ì¹´í”¼**: ì¸ë¥˜ëŠ” ë‹¬ì— ê°€ì„œë„ ì˜ì–´ë¥¼ ë§í•œë‹¤.\n**ì„¤ëª…**: ì–´ë–¤ ê³³ì—ì„œë„ ì†Œí†µì´ ì¤‘ìš”í•œ ìˆœê°„ì´ ì°¾ì•„ì˜µë‹ˆë‹¤.",
        "**ì¹´í”¼**: ëˆ„êµ°ê°€ë¡œ ëë‚˜ì§€ ë§ˆë¼.\n**ì„¤ëª…**: ì´ ë„ì‹œëŠ” ë‹¹ì‹ ë§Œì˜ ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ ê¸°íšŒë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
        "**ì¹´í”¼**: ë§ˆí”ì‚´ì€ ë‘ë²ˆì§¸ ìŠ¤ë¬´ì‚´.\n**ì„¤ëª…**: ìƒˆë¡œìš´ ì‹œì‘ì„ ì¶•í•˜í•˜ëŠ” ì—¬í–‰ì§€, ì—¬ê¸°ì„œ ì¸ìƒì˜ ë‹¤ìŒ ì¥ì„ ì—´ì–´ë³´ì„¸ìš”.",
        "**ì¹´í”¼**: ê¸°ì ì€ ìš°ì—°ì„ ê°€ì¥í•´ ë‚˜íƒ€ë‚œë‹¤.\n**ì„¤ëª…**: ì¼ìƒì˜ ìˆœê°„ë“¤ì´ íŠ¹ë³„í•´ì§€ëŠ” ì´ê³³ì„ ë§Œë‚˜ë³´ì„¸ìš”.",
        "**ì¹´í”¼**: ë›°ì–´ë‚œ íŒ€ì—ëŠ” ë›°ì–´ë‚œ 2ì¸ìê°€ ìˆë‹¤.\n**ì„¤ëª…**: ì´ ë„ì‹œì˜ ìˆ¨ì€ ë§¤ë ¥ë“¤ì´ ë‹¹ì‹ ì„ ë•ëŠ” ë™ë°˜ìê°€ ë©ë‹ˆë‹¤.",
        "**ì¹´í”¼**: ì¸ìƒì˜ ë“±ì¥ì¸ë¬¼ì´ ë‹¬ë¼ì§„ë‹¤.\n**ì„¤ëª…**: ì´ ì—¬í–‰ì§€ëŠ” ë‹¹ì‹ ì˜ ìƒˆë¡œìš´ ì´ì•¼ê¸°ë¥¼ ìœ„í•œ ë¬´ëŒ€ì…ë‹ˆë‹¤."
    ]

    # ì˜ˆì‹œ ì¹´í”¼ ë¦¬ìŠ¤íŠ¸ í¸ì§‘ ê°€ëŠ¥
    edited_copies = st.text_area(
        "ì˜ˆì‹œ ìˆ˜ì •/ì¶”ê°€",
        value="\n\n".join(example_copies),
        height=300,
        key="copy_examples"
    )

    # ìµœì¢… í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° ë° ìˆ˜ì •
    st.markdown("#### ğŸ“ ìµœì¢… í”„ë¡¬í”„íŠ¸")
    final_prompt = f"{base_structure}\n\n{edited_docs}\n\nìš”êµ¬ì‚¬í•­:\n{requirements}\n\nì°¸ê³  ì˜ˆì‹œ:\n{edited_copies}"
    edited_prompt = st.text_area(
        "í”„ë¡¬í”„íŠ¸ ì§ì ‘ ìˆ˜ì •",
        value=final_prompt,
        height=400,
        key="final_prompt"
    )

    # ìƒì„± ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œì˜ ë¡œì§ ìˆ˜ì •
    if st.button("ğŸ¨ ê´‘ê³  ì¹´í”¼ ìƒì„±", use_container_width=True):
        if not selected_region or not selected_generation:
            st.error("ì§€ì—­ê³¼ ì„¸ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!")
        else:
            with st.spinner("AI ëª¨ë¸ì´ ê´‘ê³  ì¹´í”¼ë¥¼ ìƒì„±ì¤‘ì…ë‹ˆë‹¤..."):
                results = {}
                evaluations = {}
                
                for model in ["gpt", "gemini", "claude"]:
                    result = generate_copy(edited_prompt, model)
                    
                    # resultê°€ ë¬¸ìì—´ì¸ì§€ ë¨¼ì € í™•ì¸í•˜ê³  ë¬¸ìì—´ì¼ ê²½ìš° ì˜¤ë¥˜ ë©”ì‹œì§€ë¡œ ì²˜ë¦¬
                    if isinstance(result, dict) and result.get("success"):
                        # resultê°€ dictì¼ ê²½ìš° ì •ìƒ ì²˜ë¦¬
                        results[model] = result["content"]
                        eval_result = st.session_state.evaluator.evaluate(result["content"], "gpt")  # í‰ê°€ ì‹œ gptë¡œ ê³ ì •
                        evaluations[model] = eval_result
                    elif isinstance(result, str):
                        # gemini/claudeê°€ ë¬¸ìì—´ë¡œ ìƒì„±í•œ ê²°ê³¼ë¥¼ gptë¡œ í‰ê°€
                        results[model] = result
                        eval_result = st.session_state.evaluator.evaluate(result, "gpt")  # í‰ê°€ ì‹œ gptë¡œ ê³ ì •
                        evaluations[model] = eval_result
                    else:
                        # ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ ê°’ ì„¤ì •
                        results[model] = "ê²°ê³¼ ì—†ìŒ"
                        evaluations[model] = {
                            "score": 0,
                            "reason": "í‰ê°€ ì‹¤íŒ¨",
                            "detailed_scores": [0] * len(st.session_state.scoring_config.criteria)
                        }
                
                experiment_data = {
                    "timestamp": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
                    "prompt": edited_prompt,
                    "results": results,
                    "evaluations": evaluations,
                    "settings": {
                        "region": selected_region,
                        "generation": selected_generation,
                        "season": selected_season if selected_season else None,
                        "mbti": selected_mbti if include_mbti else None
                    }
                }
                st.session_state.history.append(experiment_data)


                
# with col2 ë¶€ë¶„ì˜ ì„±ëŠ¥ ë¶„ì„ í‘œì‹œ ì½”ë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •
with col2:
    st.subheader("ì‹¤í—˜ ê²°ê³¼")
    
    if st.session_state.history:
        latest_experiment = st.session_state.history[-1]
        
        # ì„±ëŠ¥ ë¶„ì„
        analysis = analyze_prompt_performance(st.session_state.history)
        if analysis:
            try:
                # HTML íƒœê·¸ê°€ ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì»¨í…Œì´ë„ˆì™€ ë§ˆí¬ë‹¤ìš´ ì‚¬ìš©
                with st.container():
                    st.markdown("### ğŸ“ˆ ì„±ëŠ¥ ë¶„ì„")
                    st.write(f"í˜„ì¬ í‰ê·  ì ìˆ˜: {analysis['current_score']:.1f}")
                    st.write(f"ì´ì „ ëŒ€ë¹„: {analysis['improvement']:+.1f}")
                    st.write(f"ìµœê³  ì„±ëŠ¥ ëª¨ë¸: {analysis['top_model'].upper()}")
                    
                    # ê°œì„  í¬ì¸íŠ¸ë¥¼ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ í‘œì‹œ
                    if analysis['suggestions']:
                        st.markdown("#### ğŸ’¡ ê°œì„  í¬ì¸íŠ¸:")
                        for suggestion in analysis['suggestions']:
                            st.markdown(f"- {suggestion}")
                    
            except Exception as e:
                st.error(f"ì„±ëŠ¥ ë¶„ì„ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
        
        # ê²°ê³¼ ì¹´ë“œ í‘œì‹œ
        model_list = ["gpt", "gemini", "claude"]
        for idx, model_name in enumerate(model_list):
            try:
                with st.container():
                    # 'latest_experiment['results']'ê°€ ë”•ì…”ë„ˆë¦¬ì¸ì§€ í™•ì¸ í›„ ì²˜ë¦¬
                    if isinstance(latest_experiment.get('results'), dict):
                        result = latest_experiment['results'].get(model_name, "ê²°ê³¼ ì—†ìŒ")
                    else:
                        result = "ê²°ê³¼ ì—†ìŒ"
                    
                    # 'latest_experiment['evaluations']'ê°€ ë”•ì…”ë„ˆë¦¬ì¸ì§€ í™•ì¸ í›„ ì²˜ë¦¬
                    eval_data = (latest_experiment.get('evaluations', {}).get(model_name) 
                                 if isinstance(latest_experiment.get('evaluations'), dict) 
                                 else {
                                     "score": 0,
                                     "reason": "í‰ê°€ ì‹¤íŒ¨",
                                     "detailed_scores": [0] * len(st.session_state.scoring_config.criteria)
                                 })
        
                    # ì •ê·œì‹ìœ¼ë¡œ ì¹´í”¼ì™€ ì„¤ëª… ì¶”ì¶œ
                                        
                    # 'result'ì—ì„œ ì¹´í”¼ì™€ ì„¤ëª… ì¶”ì¶œ
                    def extract_copy_and_description(result_text):
                        """
                        Extract 'ì¹´í”¼' and 'ì„¤ëª…' from the given text.
                        If the format is unexpected, provide detailed feedback for debugging.
                        """
                        # Check if both "ì¹´í”¼" and "ì„¤ëª…" exist
                        if "**ì¹´í”¼**:" in result_text and "ì„¤ëª…:" in result_text:
                            match = re.search(r"\*\*ì¹´í”¼\*\*:\s*(.*?)\s*ì„¤ëª…:\s*(.*)", result_text, re.DOTALL)
                            if match:
                                copy_text = match.group(1).strip()
                                description_text = match.group(2).strip()
                                return copy_text, description_text
                        elif "**ì¹´í”¼**:" in result_text:
                            # Only 'ì¹´í”¼' exists
                            match = re.search(r"\*\*ì¹´í”¼\*\*:\s*(.*)", result_text, re.DOTALL)
                            if match:
                                copy_text = match.group(1).strip()
                                return copy_text, "ì„¤ëª… ì—†ìŒ"
                        elif "ì„¤ëª…:" in result_text:
                            # Only 'ì„¤ëª…' exists
                            match = re.search(r"ì„¤ëª…:\s*(.*)", result_text, re.DOTALL)
                            if match:
                                description_text = match.group(1).strip()
                                return "ì¹´í”¼ ì—†ìŒ", description_text
                        else:
                            # Neither 'ì¹´í”¼' nor 'ì„¤ëª…' exists
                            return "ì¹´í”¼ ì—†ìŒ", "ì„¤ëª… ì—†ìŒ"
                    
                    # Extracting text
                    copy_text, description_text = extract_copy_and_description(result)
                    
                    # Render HTML
                    st.markdown(f"""
                    <div class="result-card" style="border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; background-color: #f9f9f9;">
                        <span class="model-tag" style="background-color: {MODEL_COLORS.get(model_name, '#6c757d')}; color: #fff; padding: 0.3rem 0.6rem; font-weight: bold; border-radius: 5px;">
                            {model_name.upper()}
                        </span>
                        <div style="margin-top: 1rem; font-size: 1.2rem; font-weight: bold;">
                            <b>ì¹´í”¼:</b> {copy_text}
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 1rem; color: #333;">
                            <b>ì„¤ëª…:</b> {description_text}
                        </div>
                        <div class="score-badge" style="margin-top: 1rem; font-size: 1.2rem; font-weight: bold;">
                            ì ìˆ˜: {eval_data.get('score', 0)}ì 
                        </div>
                        <div class="prompt-feedback" style="margin-top: 0.5rem; font-size: 1rem; color: #555;">
                            {eval_data.get('reason', 'í‰ê°€ ì´ìœ  ì—†ìŒ')}
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
                    
                    if 'detailed_scores' in eval_data:
                        try:
                            fig = visualize_evaluation_results(eval_data)
                            st.plotly_chart(fig, use_container_width=True)
                        except Exception as e:
                            st.error(f"ì°¨íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
            except Exception as e:
                st.error(f"ê²°ê³¼ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ({model_name}): {str(e)}")

    else:
        st.info("ê´‘ê³  ì¹´í”¼ë¥¼ ìƒì„±í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.")

# ì§€ë„ ì„¹ì…˜ ì¶”ê°€
st.markdown("---")  # êµ¬ë¶„ì„ 

# ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ë°± ì œê±°
with st.container():
    st.markdown("""
        <h3 style="
            color: #1a73e8;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        ">
            ğŸ—ºï¸ ì§€ì—­ë³„ ê´‘ê³  ì¹´í”¼ ëŒ€ì‹œë³´ë“œ
            <span style="
                font-size: 0.8em;
                color: rgba(255,255,255,0.6);
                font-weight: 400;
            ">
                Regional Ad-Copy Dashboard
            </span>
        </h3>
    """, unsafe_allow_html=True)
    # ì»¨íŠ¸ë¡¤ íŒ¨ë„ì„ ì¢ì€ ì»¬ëŸ¼ì— ë°°ì¹˜
    col_control, col_map = st.columns([0.25, 0.75])
    
    with col_control:
        selected_regions = st.multiselect(
            "ì§€ì—­ ì„ íƒ",
            options=list(CITY_COORDINATES.keys()),
            default=["ë¶€ì‚° í•´ìš´ëŒ€"],
            help="ì—¬ëŸ¬ ì§€ì—­ì„ ì„ íƒí•˜ì—¬ í•œ ë²ˆì— ê´‘ê³  ì¹´í”¼ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        )
        
        selected_generation = st.selectbox(
            "íƒ€ê²Ÿ ì„¸ëŒ€ ì„ íƒ",
            list(DOCS["generation"].keys()),
            key="map_generation"
        )

        include_mbti = st.checkbox("MBTI íŠ¹ì„± í¬í•¨", key="map_mbti_check")
        if include_mbti:
            selected_mbti = st.selectbox(
                "MBTI ì„ íƒ",
                options=MBTI_TYPES,
                key="map_mbti"
            )
        else:
            selected_mbti = None

        selected_season = st.selectbox(
            "ê³„ì ˆ ì„ íƒ (ì„ íƒì‚¬í•­)",
            options=[""] + list(SEASONS.keys()),
            format_func=lambda x: "ê³„ì ˆì„ ì„ íƒí•˜ì„¸ìš”" if x == "" else x,
            key="map_season"
        )

        # ìƒì„± ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
        if st.button("ğŸ¨ 16ëª…ì˜ ë©€í‹° í˜ë¥´ì†Œë‚˜ ì—¬í–‰ì§€ í™ë³´ ì¹´í”¼ë¼ì´íŒ… ìƒì„±", use_container_width=True):
            if not selected_regions or not selected_generation:
                st.error("ì§€ì—­ê³¼ ì„¸ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!")
            else:
                with st.spinner("AI ëª¨ë¸ì´ ë‹¤ì–‘í•œ ê´€ì ì˜ ì—¬í–‰ì§€ í™ë³´ ì¹´í”¼ë¼ì´íŒ…ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤..."):
                    try:
                        # ëœë¤í•˜ê²Œ 10ëª…ì˜ í˜ë¥´ì†Œë‚˜ ì„ íƒ
                        selected_region = selected_regions[0]
                        selected_personas = get_balanced_random_personas(16)  # ì—¬ê¸°ë¥¼ ë³€ê²½
                        # ì§„í–‰ ìƒí™© í‘œì‹œ
                        progress_text = st.empty()
                        progress_bar = st.progress(0)
                        
                        persona_results = {}
                        for idx, persona_name in enumerate(selected_personas):
                            try:
                                progress_text.text(f"âœï¸ {persona_name}ì˜ ì‹œì„ ìœ¼ë¡œ ì¹´í”¼ ìƒì„± ì¤‘...")
                                
                                city_doc = DOCS["region"].get(selected_region, "")
                                if not city_doc:
                                    continue
                                
                                persona_data = PERSONAS.get(persona_name, {})
                                if not persona_data:
                                    continue
                                    
                                prompt = create_adaptive_prompt(
                                    city_doc=city_doc,
                                    target_generation=selected_generation,
                                    persona_name=persona_name,
                                    mbti=selected_mbti if include_mbti else None,
                                    include_mbti=include_mbti
                                )
                                
                                if prompt:
                                    result = generate_copy(prompt, "gpt")
                                    if result.get('success', False):
                                        persona_results[persona_name] = {
                                            "copy": result.get('content', ''),
                                            "persona_info": persona_data,
                                            "category": get_safe_persona_info(persona_data, 'category', 'unknown')
                                        }
                                    
                                progress_bar.progress((idx + 1) / len(selected_personas))
                                
                            except Exception as e:
                                print(f"{persona_name} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: {str(e)}")
                                continue
                        
                        # ì§„í–‰ í‘œì‹œ ì œê±°
                        progress_text.empty()
                        progress_bar.empty()
        
                        if persona_results:  # ê²°ê³¼ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì§€ë„ì™€ ê²°ê³¼ í‘œì‹œ
                
                            # ì§€ë„ì™€ ê²°ê³¼ë¥¼ í•¨ê»˜ í‘œì‹œí•  ì»¨í…Œì´ë„ˆ
                            st.markdown(f"### ğŸ—ºï¸ ë‹¤ì–‘í•œ ì‹œì„ ìœ¼ë¡œ ë°”ë¼ë³¸ {selected_region}")
                            
                            # ì§€ë„ ìƒì„±
                            m = folium.Map(
                                location=[CITY_COORDINATES[selected_region]["lat"], 
                                        CITY_COORDINATES[selected_region]["lon"]],
                                zoom_start=14,
                                tiles='CartoDB dark_matter'
                            )
        
                            # 4x4 ê·¸ë¦¬ë“œ ìœ„ì¹˜ ê³„ì‚°ì„ ìœ„í•œ ê¸°ì¤€ì ê³¼ ì˜¤í”„ì…‹ ì„¤ì •
                            base_lat = CITY_COORDINATES[selected_region]["lat"]
                            base_lon = CITY_COORDINATES[selected_region]["lon"]
                            lat_offset = 0.004  # ìœ„ë„ ê°„ê²©
                            lon_offset = 0.005  # ê²½ë„ ê°„ê²©
                            grid_size = 4

                            # Diviconì„ ì‚¬ìš©í•˜ì—¬ í•­ìƒ ë³´ì´ëŠ” ë¼ë²¨ ì¶”ê°€
                                

                            
                            # ë§ˆì»¤ ì¶”ê°€
                            for idx, (persona_name, result) in enumerate(persona_results.items()):
                                try:
                                    category_color = get_safe_persona_info(
                                        PERSONA_CATEGORIES.get(
                                            get_safe_persona_info(result.get('persona_info', {}), 'category', 'unknown'),
                                            {}
                                        ),
                                        'color',
                                        '#333'
                                    )
                                    
                                    # 4x4 ê·¸ë¦¬ë“œ ìœ„ì¹˜ ê³„ì‚°
                                    row = idx // grid_size
                                    col = idx % grid_size
                                    
                                    marker_lat = base_lat + (lat_offset * (row - (grid_size-1)/2))
                                    marker_lon = base_lon + (lon_offset * (col - (grid_size-1)/2))


                                    html = f"""
                                        <div style="
                                            position: relative;
                                            left: 10px;
                                            top: -10px;
                                            background-color: rgba(255, 255, 255, 0.95);
                                            padding: 8px;
                                            border-radius: 8px;
                                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                            border: 2px solid {get_safe_persona_info(PERSONA_CATEGORIES.get(result.get('category', 'unknown'), {}), 'color', '#333')};
                                            min-width: 150px;
                                            max-width: 200px;
                                        ">
                                            <b style="
                                                color: {get_safe_persona_info(PERSONA_CATEGORIES.get(result.get('category', 'unknown'), {}), 'text_color', '#333')};
                                                font-size: 12px;
                                            ">{persona_name}{' ' + get_safe_persona_info(result.get('persona_info', {}), 'nationality', '') if get_safe_persona_info(result.get('persona_info', {}), 'nationality') else ''}</b>
                                            <p style="
                                                margin: 4px 0 0 0;
                                                color: #333;
                                                font-size: 11px;
                                                line-height: 1.4;
                                            ">{get_safe_persona_info(result, 'copy', 'ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.')}</p>
                                        </div>
                                    """

                                    
                                    # DivIcon ìƒì„± ë° ì¶”ê°€
                                    icon = folium.DivIcon(
                                        html=html,
                                        icon_size=(150, 100),
                                        icon_anchor=(0, 0)
                                    )
                                    
                                    folium.Marker(
                                        [marker_lat, marker_lon],
                                        icon=icon
                                    ).add_to(m)
                                    
                                except Exception as e:
                                    print(f"ë§ˆì»¤ ìƒì„± ì¤‘ ì˜¤ë¥˜: {str(e)}")
                                    continue
                            
                            # ì§€ë„ ê²½ê³„ ì„¤ì •
                            bounds = [
                                [base_lat - (lat_offset * 3), base_lon - (lon_offset * 3)],
                                [base_lat + (lat_offset * 3), base_lon + (lon_offset * 3)]
                            ]
                            m.fit_bounds(bounds, padding=(150, 150))
        
                            # ì§€ë„ í‘œì‹œ
                            folium_static(m)
                            
                            
                            # ê²°ê³¼ ì €ì¥ ë¶€ë¶„ì„ try-exceptë¡œ ê°ì‹¸ê³  ìƒíƒœ í‘œì‹œ ì¶”ê°€
                            try:
                                if persona_results:  # ê²°ê³¼ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì €ì¥ ë²„íŠ¼ í‘œì‹œ
                                    col1, col2 = st.columns([1, 2])
                                    with col1:
                                        if st.button("ğŸ’¾ ê²°ê³¼ ì €ì¥í•˜ê¸°", use_container_width=True):
                                            try:
                                                # DataFrame ìƒì„±
                                                df = pd.DataFrame([
                                                    {
                                                        "í˜ë¥´ì†Œë‚˜": name,
                                                        "ì¹´í…Œê³ ë¦¬": data["category"],
                                                        "ê´‘ê³ ì¹´í”¼": data.get("copy", ""),  # getìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì ‘ê·¼
                                                        "ìƒì„±ì‹œê°„": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                                                    }
                                                    for name, data in persona_results.items()
                                                    if isinstance(data, dict)  # ë°ì´í„°ê°€ ë”•ì…”ë„ˆë¦¬ì¸ ê²½ìš°ë§Œ ì²˜ë¦¬
                                                ])
                                                
                                                if not df.empty:
                                                    # CSV íŒŒì¼ ìƒì„±
                                                    csv = df.to_csv(index=False).encode('utf-8-sig')
                                                    
                                                    # ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í‘œì‹œ
                                                    with col2:
                                                        st.download_button(
                                                            label=f"ğŸ“¥ {selected_region} ê´‘ê³ ì¹´í”¼ ë‹¤ìš´ë¡œë“œ",
                                                            data=csv,
                                                            file_name=f'{selected_region}_ê´‘ê³ ì¹´í”¼_{datetime.now().strftime("%Y%m%d_%H%M%S")}.csv',
                                                            mime='text/csv',
                                                            help="ìƒì„±ëœ ëª¨ë“  í˜ë¥´ì†Œë‚˜ì˜ ê´‘ê³ ì¹´í”¼ê°€ CSV íŒŒì¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤."
                                                        )
                                                        st.success("âœ… CSV íŒŒì¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!")
                                                else:
                                                    st.warning("ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
                                                    
                                            except Exception as e:
                                                st.error(f"íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")
                                    
                            except Exception as e:
                                st.error(f"ì €ì¥ ê¸°ëŠ¥ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")
        
                    except Exception as e:
                        st.error(f"ê´‘ê³  ì¹´í”¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")
